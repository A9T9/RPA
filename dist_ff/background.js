!function(e){function t(t){for(var r,a,s=t[0],c=t[1],u=t[2],d=0,h=[];d<s.length;d++)a=s[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&h.push(o[a][0]),o[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(l&&l(t);h.length;)h.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={2:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;i.push([1079,1,0]),n()}({105:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(153),o=n(12);!function(e){e.Normal="NORMAL",e.Success="SUCCESS",e.Error="ERROR",e.ErrorInSub="ERROR_IN_SUB"}(t.MacroResultStatus||(t.MacroResultStatus={}));class i extends r.KeyValueData{getAll(){return super.get("")}getMainKeyAndSubKeys(e){const[t,n]=super.getMainKeyAndSubKeys(e);return[i.STORAGE_KEY,[t].concat(n).filter(e=>e&&e.length)]}}t.MacroExtraKeyValueData=i,i.STORAGE_KEY="macro_extra",t.getMacroExtraKeyValueData=o.singletonGetter(()=>new i)},107:function(e,t,n){"use strict";n.r(t);n(170);var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=function(){var e=window.requestFileSystem||window.webkitRequestFileSystem;if(!e)throw new Error("requestFileSystem not supported");var t=function(t){return t=t||5242880,new Promise((function(n,r){e(window.TEMPORARY,t,n,r)}))},n=function(e,n,r){var o=(Array.isArray(e)?e:e.split("/")).filter((function(e){return e&&e.length}));return(r?Promise.resolve(r):t(1048576)).then((function(e){return function e(t,r){return t&&t.length?new Promise((function(e,o){r.getDirectory(t[0],{create:!!n},(function(t){return e(t)}),(function(e){return o(e)}))})).then((function(n){return e(t.slice(1),n)})):Promise.resolve(r)}(o,e.root)}))},o=function(e,t){var r=e.split("/");return n(r.slice(0,-1),!1,t).then((function(e){return{directoryEntry:e,fileName:r.slice(-1)[0]}}))},i=function(e,n){if(-1===["ArrayBuffer","BinaryString","DataURL","Text"].indexOf(n))throw new Error("invalid readFile type, '"+n+"'");return t().then((function(t){return o(e,t).then((function(e){var t=e.directoryEntry,r=e.fileName;return new Promise((function(e,o){t.getFile(r,{},(function(t){t.file((function(t){var r=new FileReader;switch(r.onerror=o,r.onloadend=function(){e(this.result)},n){case"ArrayBuffer":return r.readAsArrayBuffer(t);case"BinaryString":return r.readAsBinaryString(t);case"DataURL":return r.readAsDataURL(t);case"Text":return r.readAsText(t);default:throw new Error("unsupported data type, '"+n)}}),o)}),o)}))}))})).catch((function(e){throw console.warn("readFile",e.code,e.name,e.message),e}))},a=function(e,n,r){return t(r).then((function(t){return o(e,t).then((function(e){var t=e.directoryEntry,r=e.fileName;return new Promise((function(e,o){t.getFile(r,{create:!0},(function(t){t.createWriter((function(r){r.onwriteend=function(){return e(t.toURL())},r.onerror=o,r.write(n)}))}),o)}))}))})).catch((function(e){throw console.warn(e.code,e.name,e.message),e}))},s=function(e){return t().then((function(t){return o(e,t).then((function(e){var t=e.directoryEntry,n=e.fileName;return new Promise((function(e,r){t.getFile(n,{create:!0},(function(t){t.remove(e,r)}),r)}))}))})).catch((function(e){throw console.warn("removeFile",e.code,e.name,e.message),e}))},c=function(e){return t().then((function(t){return o(e,t).then((function(e){var t=e.directoryEntry,n=e.fileName,o=function(e){return new Promise((function(r){t[e](n,{create:!1},(function(e){r(!0)}),(function(){return r(!1)}))}))},i=o("getFile"),a=o("getDirectory");return Promise.all([i,a]).then((function(e){var t=r(e,2);return{isFile:t[0],isDirectory:t[1]}}))}))})).catch((function(e){if(e&&8===e.code)return{isFile:!1,isDirectory:!1};throw console.warn("fs.exists",e.code,e.name,e.message),e}))};return{list:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/";return t(1048576).then((function(t){return new Promise((function(t,r){n(e).then((function(e){var n=[],o=e.createReader();!function e(){o.readEntries((function(r){0===r.length?t(n.sort()):(n=n.concat(Array.from(r)),e())}),r)}()})).catch(r)}))})).catch((function(e){throw console.warn("list",e.code,e.name,e.message),e}))},readFile:i,writeFile:a,removeFile:s,moveFile:function(e,n){return t().then((function(t){return Promise.all([o(e,t),o(n,t)]).then((function(t){var r=t[0].directoryEntry,o=t[0].fileName,c=t[1].directoryEntry,u=t[1].fileName;return new Promise((function(t,l){r.getFile(o,{},(function(r){try{r.moveTo(c,u,t,l)}catch(r){i(e,"ArrayBuffer").then((function(e){return a(n,new Blob([new Uint8Array(e)]))})).then((function(){return s(e)})).then(t,l)}}),l)}))}))}))},copyFile:function(e,n){return t().then((function(t){return Promise.all([o(e,t),o(n,t)]).then((function(t){var r=t[0].directoryEntry,o=t[0].fileName,s=t[1].directoryEntry,c=t[1].fileName;return new Promise((function(t,u){r.getFile(o,{},(function(r){try{r.copyTo(s,c,t,u)}catch(r){i(e,"ArrayBuffer").then((function(e){return a(n,new Blob([new Uint8Array(e)]))})).then(t,u)}}),u)}))}))})).catch((function(e){throw console.warn("copyFile",e.code,e.name,e.message),e}))},getDirectory:n,getMetadata:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t().then((function(t){return e.getMetadata?new Promise((function(t,n){return e.getMetadata(t)})):o(e,t).then((function(e){var t=e.directoryEntry,r=e.fileName;return new Promise((function(e,o){var i=[r,{create:!1},function(t){t.getMetadata(e)},o];n?t.getDirectory.apply(t,i):t.getFile.apply(t,i)}))}))})).catch((function(e){throw console.warn("getMetadata",e.code,e.name,e.message),e}))},ensureDirectory:function(e,t){return n(e,!0,t)},exists:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.type;return c(e).then((function(e){switch(n){case"file":return e.isFile;case"directory":return e.isDirectory;default:return e.isFile||e.isDirectory}}))},existsStat:c,rmdir:function(e,t){return n(e,!1,t).then((function(e){return new Promise((function(t,n){e.remove(t,n)}))}))},rmdirR:function(e,t){return n(e,!1,t).then((function(e){return new Promise((function(t,n){return e.removeRecursively(t,n)}))}))}}}();window.fs=o,t.default=o},1079:function(e,t,n){"use strict";n.r(t),function(e){var t=n(10),r=n.n(t),o=n(4),i=n(93),a=n(17),s=n(11),c=n.n(s),u=n(411),l=n(94),d=n(36),h=n(653),f=n(119),g=n(34),m=n.n(g),p=n(654),w=n(13),y=n(32),v=n(393),b=n(64),S=n(91),E=n(65),_=n(412),P=n(87),T=n(22),I=n(74),x=n(361),C=n(12),A=n(42),O=n(146),R=n(324),D=n(366),N=n(359),M=n(75),k=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},L=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var j=/Linux/i.test(window.navigator.userAgent)?200:0,U={status:a.APP_STATUS.NORMAL,tabIds:{lastActivated:[],lastInspect:null,lastRecord:null,toInspect:null,firstRecord:null,toRecord:null,lastPlay:null,firstPlay:null,toPlay:null,panel:null},pullback:!1,heartBeatSecret:0,disableHeartBeat:!1,pendingPlayingTab:!1,xClickNeedCalibrationInfo:null,lastCsIpcSecret:null,closingAllWindows:!1},B=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.disabled,n=void 0!==t&&t;U.heartBeatSecret=n?-1:(Math.max(0,U.heartBeatSecret)+1)%1e4},H=function(e,t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;return Object(o.retry)((function(){var n=U.tabIds[e];return n?r.a.tabs.get(n):Promise.reject(new Error("No tab for "+t+" yet"))}),{timeout:n,retryInterval:100,shouldRetry:function(){return!0}})().then((function(e){if(!e)throw new Error("The "+t+" tab seems to be closed");return Object(b.getIpcCache)().get(e.id,n,i).catch((function(e){throw new Error("No ipc available for the "+t+" tab")}))}))}},V=H("toRecord","recording"),G=H("toPlay","playing commands"),W=(H("toInspect","inspect"),H("panel","dashboard")),X=function(e){var t=new Error("No connection to browser tab"),n=function(e){if(!e)throw t;return Object(E.createTab)(e).then((function(e){return U.tabIds.lastPlay=U.tabIds.toPlay,U.tabIds.toPlay=U.tabIds.firstPlay=e.id,e}))};return c()("getPlayTab - pendingPlayingTab",U.pendingPlayingTab),(U.pendingPlayingTab?Object(o.until)("pendingPlayingTab reset",(function(){return{pass:!U.pendingPlayingTab,result:!0}}),100,5e3):Promise.resolve()).then((function(){if(!U.tabIds.toPlay&&!e)throw t;return U.tabIds.toPlay?Object(E.getTab)(U.tabIds.toPlay).then((function(t){if(!e)return t;Object(b.getIpcCache)().disable(t.id);var n=function(){try{return new URL(e,t.url).toString()}catch(t){return e}}();return Object(E.updateUrlForTab)(t,n)}),(function(){return n(e)})):n(e)}))},K=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.params;return Object(E.activateTab)(U.tabIds.panel,!0).catch((function(){d.default.get("config").then((function(e){return((e=e||{}).size||{})[e.showSidebar?"with_sidebar":"standard"]})).then((function(e){e=e||{width:850,height:775};var n=Object.keys(t||{}).map((function(e){return e+"="+t[e]})).join("&"),i=r.a.extension.getURL("popup.html"),a=n.length>0?i+"?"+n:i;return ne().updateLogFileName(),ne().logWithTime("UI.Vision RPA started"),U.closingAllWindows=!1,r.a.windows.create({url:a,type:"popup",width:e.width,height:e.height}).then((function(t){if(r.a.isFirefox())return Object(o.delay)((function(){return r.a.windows.update(t.id,{width:e.width+1,height:e.height+1})}),1e3)})),!0}))}))},Y=function(e){return K(e).then((function(){return W(6e3)}))},$=function(e){var t=L({clear:!1,text:"",color:"#ff0000",blink:0},e||{}),n=t.clear,o=t.text,i=t.color,a=t.blink;return n?r.a.browserAction.setBadgeText({text:""}):(r.a.browserAction.setBadgeBackgroundColor({color:i}),r.a.browserAction.setBadgeText({text:o}),a&&setTimeout((function(){r.a.browserAction.getBadgeText({}).then((function(e){return e===o&&r.a.browserAction.setBadgeText({text:""})}))}),a),!0)},q=function(e,t){return $(L({color:"#ff0000",text:"R"},t||{},{clear:!e}))},z=function(e,t){return $(L({color:"#ffa800",text:"S"},t||{},{clear:!e}))},J=function(e,t){return $(L({color:"#14c756",text:"P"},t||{},{clear:!e}))},Z=function(e){var t,n=Object(o.uid)();r.a.notifications.create(n,{type:"basic",iconUrl:"./logo.png",title:"Record command!",message:(t=[],t.push("command: "+e.cmd),e.target&&t.push("target: "+e.target),e.value&&t.push("value: "+e.value),t.join("\n"))}),setTimeout((function(){r.a.notifications.clear(n).catch((function(e){return c.a.error(e)}))}),2e3)},Q=function e(t){Promise.all([r.a.tabs.get(t),W().catch((function(){return null}))]).then((function(n){var i=k(n,2),a=i[0],s=i[1];if(s&&-1===a.url.indexOf(r.a.extension.getURL("")))return a.title&&0!==a.title.trim().length?s.ask("UPDATE_ACTIVE_TAB",{url:a.url,title:a.title}):Object(o.delay)((function(){return e(t)}),200)}))},ee=Object(C.singletonGetterByKey)((function(e){return e}),(function(e,t){return new w.StorageManager(e,t)})),te=function(){return Promise.all([d.default.get("config"),Object(y.getXFile)().getConfig()]).then((function(e){var t=k(e,2),n=t[0];t[1];return ee(n.storageMode)}))},ne=Object(C.singletonGetter)((function(){return new R.LogService({waitForStorageManager:te})})),re=function(e,t){return te().then((function(n){return n.getScreenshotStorage().overwrite(Object(o.ensureExtName)(".png",e),Object(o.dataURItoBlob)(t)).then((function(){W().then((function(e){return e.ask("RESTORE_SCREENSHOTS")}))}))}))},oe=function(e){return re(a.LAST_SCREENSHOT_FILE_NAME,e)},ie=function(e){return re(a.LAST_DESKTOP_SCREENSHOT_FILE_NAME,e)},ae=function(e){var t=e.searchArea,n=e.storedImageRect,r=e.dpiScale;/\.png/.test(t)&&(t="rect");return G().then((function(e){var i=U.tabIds.toPlay;return c()("getTargetImage tabIds",U.tabIds,i),Object(E.activateTab)(i,!0).then((function(){return Object(o.delay)((function(){}),j)})).then((function(){return function(e,r){switch(t){case"viewport":return Promise.all([e.ask("SCREENSHOT_PAGE_INFO",{},3e3),Object(l.c)(r)]).then((function(e){var t=k(e,2),n=t[0],r=t[1];return oe(r),{offset:{x:n.originalX,y:n.originalY},viewportOffset:{x:0,y:0},dataUrl:r}}));case"full":return Promise.all([e.ask("SCREENSHOT_PAGE_INFO",{},3e3),Object(l.b)(r,{startCapture:function(){return e.ask("START_CAPTURE_FULL_SCREENSHOT",{},3e3)},endCapture:function(t){return e.ask("END_CAPTURE_FULL_SCREENSHOT",{pageInfo:t},3e3)},scrollPage:function(t){return e.ask("SCROLL_PAGE",{offset:t},3e3)}})]).then((function(e){var t=k(e,2),n=t[0],r=t[1];return oe(r),{dataUrl:r,offset:{x:0,y:0},viewportOffset:{x:-1*n.originalX,y:-1*n.originalY}}}));case"rect":if(!n)throw new Error("rect mode: !storedImageRect should not be empty");return e.ask("SCREENSHOT_PAGE_INFO").then((function(e){return Object(l.e)(r,{rect:n,devicePixelRatio:e.devicePixelRatio}).then((function(t){return oe(t),{dataUrl:t,offset:{x:n.x+e.originalX,y:n.y+e.originalY},viewportOffset:{x:n.x,y:n.y}}}))}));default:if(/^element:/i.test(t)){if(!n)throw new Error("!storedImageRect should not be empty");var i=Object(o.ensureExtName)(".png",a.LAST_SCREENSHOT_FILE_NAME);return Promise.all([e.ask("SCREENSHOT_PAGE_INFO",{},3e3),te().then((function(e){return e.getScreenshotStorage().read(i,"DataURL")}))]).then((function(e){var t=k(e,2),r=t[0];return{dataUrl:t[1],offset:{x:n.x,y:n.y},viewportOffset:{x:n.x-r.originalX,y:n.y-r.originalY}}}))}throw new Error("Unsupported searchArea '"+t+"'")}}(e,i)})).then((function(e){return Object(l.h)(e.dataUrl,r).then((function(t){return{dataUrl:t,offset:e.offset,viewportOffset:e.viewportOffset}}))}))}))};function se(){return ne().logWithTime("UI.Vision RPA closing")}var ce,ue=function(e,t,n){return U.tabIds.lastInspect=U.tabIds.toInspect,e?(U.tabIds.toInspect=e,Promise.resolve(!0)):t?U.tabIds.toInspect?(U.tabIds.toInspect=null,n||!U.tabIds.lastInspect?Promise.resolve(!0):Object(b.getIpcCache)().get(U.tabIds.lastInspect).then((function(e){return e.ask("STOP_INSPECTING")})).catch((function(e){return c()(e.stack)}))):Promise.resolve(!0):void 0},le=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"wait",n=0;return U.timer&&clearInterval(U.timer),U.timer=setInterval((function(){n+=1e3,W().then((function(r){r.ask("TIMEOUT_STATUS",{type:t,past:n,total:e})})),n>=e&&clearInterval(U.timer)}),1e3),function(){return clearInterval(U.timer)}},de=function(e,t){switch("CS_ACTIVATE_ME"!==e&&c()("onAsk",e,t),e){case"I_AM_PANEL":return U.tabIds.panel=t.sender.tab.id,Object(D.getContextMenuService)().destroyMenus(),U.tabIds.toPlay===t.sender.tab.id&&(c()("I am panel, set toPlay to null"),U.tabIds.toPlay=U.tabIds.firstPlay=U.tabIds.lastPlay),!0;case"PANEL_SET_PROXY":return Object(O.setProxy)(t.proxy).then((function(){return!0}));case"PANEL_GET_PROXY":return Object(O.getProxyManager)().getProxy();case"PANEL_TIME_FOR_BACKUP":return d.default.get("config").then((function(e){var t=e.enableAutoBackup,n=e.lastBackupActionTime,r=e.autoBackupInterval;if(!t)return{timeout:!1,remain:-1};var o=1*new Date-(n||0);return{timeout:o>24*r*36e5,remain:o}})).then((function(e){return e.timeout}));case"PANEL_LOG":return ne().log(t.log);case"PANEL_START_RECORDING":c()("Start to record..."),U.status=a.APP_STATUS.RECORDER,ue(null,!0),q(!0);var n=[{id:"verifyText",title:"Verify Text",contexts:["page","selection"]},{id:"verifyTitle",title:"Verify Title",contexts:["page","selection"]},{id:"assertText",title:"Assert Text",contexts:["page","selection"]},{id:"assertTitle",title:"Assert Title",contexts:["page","selection"]}].map((function(e){return L({},e,{onclick:function(){V().then((function(t){return t.ask("CONTEXT_MENU_IN_RECORDING",{command:e.id})}))}})}));Object(D.getContextMenuService)().createMenus(n);var i=U.tabIds.lastActivated.filter((function(e){return e!==U.tabIds.panel})),s=i[i.length-1];return s&&Object(E.activateTab)(s,!0).catch((function(e){c.a.warn("Failed to activate current tab: "+e.message)})),!0;case"PANEL_STOP_RECORDING":return c()("Stop recording..."),Object(D.getContextMenuService)().destroyMenus(),V().then((function(e){e.ask("SET_STATUS",{status:a.CONTENT_SCRIPT_STATUS.NORMAL})})),U.status=a.APP_STATUS.NORMAL,U.tabIds.lastRecord=U.tabIds.toRecord,U.tabIds.toRecord=null,U.tabIds.firstRecord=null,q(!1),!0;case"PANEL_TRY_TO_RECORD_OPEN_COMMAND":if(U.status!==a.APP_STATUS.RECORDER)throw new Error("Not in recorder mode");return X().then((function(e){if(c()("PANEL_TRY_TO_RECORD_OPEN_COMMAND",e),!/^(https?:|file:)/.test(e.url))throw new Error("Not a valid url to record as open command");return U.tabIds.toRecord=U.tabIds.firstRecord=e.id,W().then((function(t){var n={cmd:"open",target:e.url};t.ask("RECORD_ADD_COMMAND",n),Z(n)})),!0}));case"PANEL_START_INSPECTING":return c()("start to inspect..."),U.status=a.APP_STATUS.INSPECTOR,z(!0),U.tabIds.toPlay&&Object(E.activateTab)(U.tabIds.toPlay,!0),!0;case"PANEL_STOP_INSPECTING":return c()("start to inspect..."),U.status=a.APP_STATUS.NORMAL,z(!1),ue(null,!0);case"PANEL_START_PLAYING":return c()("start to play..."),U.status=a.APP_STATUS.PLAYER,U.xClickNeedCalibrationInfo=null,ue(null,!0),J(!0),Object(f.a)().reset(),ne().check(),U.timer&&clearInterval(U.timer),!0;case"PANEL_HEART_BEAT":return U.heartBeatSecret;case"PANEL_RUN_COMMAND":U.timer&&clearInterval(U.timer),U.disableHeartBeat=!1;var g="selectWindow"===t.command.cmd&&/^\s*tab=open\s*$/i.test(t.command.target),m=function(e,t){return U.disableHeartBeat?Promise.resolve(!0):(B(),G(e,t).then((function(n){return n.ask("HEART_BEAT",{timeout:e,before:t})})).catch((function(e){throw c.a.error("at least I catched it",e.message),new Error("heart beat error thrown")})))},y=function(e){return c()("shoudWaitForCommand",e),/andWait/i.test(e.cmd)||-1!==["open","refresh"].indexOf(e.cmd)},x=function(){var e=t.command,n=1e3*e.extra.timeoutElement;switch(e.cmd){case"waitForElementVisible":case"waitForElementNotVisible":case"waitForElementPresent":case"waitForElementNotPresent":var r=parseInt(e.value,10);return isNaN(r)?n:r;default:return n}}(),C=function(e,t){var n=1e3*(e.command&&e.command.extra&&e.command.extra.timeoutPageLoad||60);return U.status===a.APP_STATUS.PLAYER&&G().then((function(r){r.ask("SET_STATUS",{status:a.CONTENT_SCRIPT_STATUS.PLAYING});U.timer&&0===t.retryCount&&clearInterval(U.timer);var i=function(){var t=1e3*(e.command.extra&&e.command.extra.timeoutPageLoad||60);switch(e.command.cmd){case"open":case"clickAndWait":case"selectAndWait":return t;case"selectWindow":var n=e.command.target;return"TAB=OPEN"===(n&&n.toUpperCase())?t:x;case"pause":case"onDownload":case"captureEntirePageScreenshot":return-1;default:return x}}();return r.ask("DOM_READY",{},i).then((function(){return r.ask("RUN_COMMAND",{command:L({},e.command,{extra:L({},e.command.extra||{},{retryInfo:t})})},i)})).then((function(t){return function(t){if(!y(e.command))return t();var r=le(n);return Promise.race([t().then((function(e){return r(),e}),(function(e){throw r(),e})),Object(o.delay)((function(){throw new Error("page load "+n/1e3+" seconds time out")}),n)])}((function(){return function(t){var r=y(e.command);!t.isIFrame&&(/AndWait/i.test(e.command.cmd)||e.command.cmd);if(!r)return Promise.resolve(t.data);var i=1e3*(t.data&&t.data.extra&&t.data.extra.timeoutElement||10);return Object(o.delay)((function(){}),2e3).then((function(){return Object(o.retry)((function(){return m().then((function(e){if(U.lastCsIpcSecret===e.secret)throw new Error("still same ipc secret");return!0}))}),{shouldRetry:function(){return!0},timeout:i,retryInterval:250})()})).catch((function(t){var n=e.command.cmd,r=/AndWait/.test(n);if(console.warn(t),r){var o=n.replace("AndWait","");throw new Error("'"+n+"' failed. No page load event detected after "+i/1e3+" seconds. Try '"+o+"' instead. Error detail: "+t.message)}throw new Error(n+"' failed. No page load event detected after "+i/1e3+" seconds. Error detail: "+t.message)})).then((function(){return G()})).then((function(e){return e.ask("DOM_READY",{},n).then((function(){return e.ask("HACK_ALERT",{},3e3)}))})).then((function(){return t.data}))}(t)}))})).then((function(e){return U.lastCsIpcSecret=e&&e.secret,e}))})).catch((function(e){throw c.a.error("all catched by runCommand - "+e.message),e}))},R=function(e){return e&&(-1!==e.indexOf("timeout reached when looking for")||-1!==e.indexOf("timeout reached when waiting for")||-1!==e.indexOf("element is found but not visible yet")||-1!==e.indexOf("IPC Promise has been destroyed"))},H=function(){return function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=Math.random();U.timerSecret=r;var i=1,a=0,s=Object(o.retry)(C,{timeout:x,shouldRetry:function(e){return c()("runCommandWithRetry - shouldRetry",e.message),/ipcPromise.*timeout/i.test(e.message)?a<i&&(W().then((function(e){return e.ask("ADD_LOG",{warning:"Web page connection issue. Retrying last command."})})),a++,!0):R(e.message)},onFirstFail:function(e){var t=(e&&e.message&&e.message.indexOf("element is found but not visible yet"),"Tag waiting");le(x,t)},onFinal:function(e,t){c()("onFinal",e,t),U.timer&&U.timerSecret===r&&clearInterval(U.timer)}});return s.apply(void 0,t).catch((function(e){if(!R(e.message))return Promise.reject(e);var n=t[0].command;return n.targetOptions&&n.targetOptions.length?C.apply(void 0,t.concat([{final:!0}])):Promise.reject(e)}))}(t).catch((function(e){if(-1!==["storeText","storeValue","storeChecked","storeAttribute"].indexOf(t.command.cmd)){return{vars:F({},t.command.value,"#LNF"),log:{error:e.message}}}if(t.command.extra&&t.command.extra.errorIgnore)return{log:{error:e.message}};throw e}))},$=Object(o.retry)((function(){var e=function(){var e=(new Date).getTime(),n=!1,r=function r(){return c()("starting heart beat"),y(t.command)||Object(f.a)().hasPendingDownload()?(B({disabled:!0}),new Promise((function(){}))):n?Promise.resolve():m(100,e).then((function(){return Object(o.delay)((function(){}),1e3).then(r)}),(function(e){throw c.a.error("lost heart beart!!",e.stack),new Error("lost heart beat when running command")}))};return r.stop=function(){c()("stopping heart beat"),n=!0},r}();return Promise.race([H().then((function(t){return e.stop(),t})).catch((function(t){throw e.stop(),t})),g?new Promise((function(){})):e()])}),{timeout:x,shouldRetry:function(e){return c()("runWithHeartBeatRetry - shouldRetry",e.message),e&&e.message&&-1!==e.message.indexOf("lost heart beat when running command")},retryInterval:function(e,t){return Math.max(1e3,Math.min(5e3,1.2*t))}}),Q=function(){return new Promise((function(e,n){e($().then((function(e){return function(e){return c()("shouldWaitForDownloadAfterRun",e),"click"===e.cmd}(t.command)?Object(f.a)().waitForDownloadIfAny().then((function(){return e}),(function(e){return Object(f.a)().reset(),Promise.reject(e)})):e})).then((function(e){return r.a.tabs.get(U.tabIds.toPlay).then((function(t){return L({},e,{pageUrl:t.url})})).catch((function(t){return c.a.error("Error in fetching play tab url"),e}))})))}))};return(at=void 0,st=1e3*(t.command&&t.command.extra&&t.command.extra.timeoutPageLoad||60),ct=function(){var e=t.command,n=e.cmd,r=e.target,o=e.value,i="open"===n?[!0,!1,r]:"selectWindow"===n&&r&&"tab=open"===r.toLowerCase().trim()?[!0,!0,o]:[!1,!1,null],a=k(i,3),s=a[0],c=a[1],u=a[2];if(!s)throw new Error("Error #101: UI.Vision RPA is not connected to a browser tab");return at&&at(),at=le(st),X(u).then((function(e){return{tab:e,shouldSkipCommandRun:c,hasOpenedUrl:!0}}))},X().catch((function(e){return{id:-1}})).then((function(e){return c()("after first getPlayTab",e),-1!==["about:blank","about:config"].indexOf(e.url)?ct():(t=function(){return Object(b.getIpcCache)().get(e.id,100).then((function(t){return{tab:e,hasOpenedUrl:!1}}),(function(e){return ct()})).then((function(e){var t=e.tab,n=e.hasOpenedUrl,r=e.shouldSkipCommandRun;return Object(b.getIpcCache)().get(t.id,st).then((function(e){return e.ask("HEART_BEAT",1e3)})).then((function(){return at&&at(),{tab:t,hasOpenedUrl:n,shouldSkipCommandRun:r}}))}))},Object(o.withTimeout)(st,(function(){return t().catch((function(e){if(/Could not establish connection/.test(e.message))return ct().then(t);throw e}))})).catch((function(e){if(/withTimeout/.test(e.message))throw new Error("UI.Vision RPA fails to open this url");throw e}))).then((function(e){var t=e.tab,n=e.hasOpenedUrl,r=e.shouldSkipCommandRun;return Promise.resolve().then((function(){return Object(b.getIpcCache)().get(t.id,6e4)})).then((function(e){return(n?e.ask("MARK_NO_COMMANDS_YET",{},3e3):Promise.resolve()).then((function(){return e.ask("SET_STATUS",{status:a.CONTENT_SCRIPT_STATUS.PLAYING},3e3)}))})).then((function(){return r}))}));var t}))).then((function(e){return!!e||Q().catch((function(e){if(c.a.error("catched by runEternally",e.stack),e&&e.message&&(-1!==e.message.indexOf("lost heart beat when running command")||-1!==e.message.indexOf("Could not establish connection")))return Q();throw e}))}));case"PANEL_STOP_PLAYING":return J(!1),U.status=a.APP_STATUS.NORMAL,Object(f.a)().reset(),U.tabIds.firstPlay=U.tabIds.toPlay,U.tabIds.lastPlay=U.tabIds.toPlay,U.timer&&clearInterval(U.timer),Object(b.getIpcCache)().get(U.tabIds.toPlay).then((function(e){return e.ask("SET_STATUS",{status:a.CONTENT_SCRIPT_STATUS.NORMAL},3e3)}));case"PANEL_HIGHLIGHT_DOM":return Promise.all([V().then((function(e){return{ipc:e,type:"record"}})).catch((function(){return null})),G().then((function(e){return{ipc:e,type:"play"}})).catch((function(){return null}))]).then((function(e){if(!e[0]&&!e[1])throw new Error("No where to look for the dom");return e.filter((function(e){return!!e}))})).then((function(e){return Promise.all(e.map((function(e){var n=e.ipc,r=e.type;return n.ask("FIND_DOM",{locator:t.locator}).then((function(e){return{result:e,type:r,ipc:n}}))})))})).then((function(e){var n=e.filter((function(e){return e.result}));if(0===n.length)throw new Error("DOM not found");var r=2===n.length?n.find((function(e){return e.type===t.lastOperation})):n[0],o=U.tabIds["record"===r.type?"lastRecord":"toPlay"];return Object(E.activateTab)(o,!0).then((function(){return r.ipc.ask("HIGHLIGHT_DOM",{locator:t.locator})}))}));case"PANEL_HIGHLIGHT_RECT":return G().then((function(e){return e.ask("HIGHLIGHT_RECT",t,3e3)}));case"PANEL_HIGHLIGHT_RECTS":return G().then((function(e){return e.ask("HIGHLIGHT_RECTS",t,3e3)}));case"PANEL_HIGHLIGHT_DESKTOP_RECTS":return Object(_.runInDesktopScreenshotEditor)({type:P.DesktopScreenshot.RequestType.DisplayVisualResult,data:{rects:t.scoredRects,image:t.imageInfo}});case"PANEL_HIGHLIGHT_OCR_MATCHES":return t.isDesktop?te().then((function(e){var n=e.getCurrentStrategyType()===w.StorageStrategyType.XFile?P.DesktopScreenshot.ImageSource.HardDrive:P.DesktopScreenshot.ImageSource.Storage;return Object(_.runInDesktopScreenshotEditor)({type:P.DesktopScreenshot.RequestType.DisplayOcrResult,data:{ocrMatches:t.ocrMatches,image:{source:n,path:Object(o.ensureExtName)(".png",a.LAST_DESKTOP_SCREENSHOT_FILE_NAME)}}})})):G().then((function(e){return e.ask("HIGHLIGHT_OCR_MATCHES",t,3e3)}));case"PANEL_CLEAR_OCR_MATCHES_ON_PLAYING_PAGE":return G().then((function(e){return Promise.all([e.ask("CLEAR_VISION_RECTS",{},3e3),e.ask("CLEAR_OCR_MATCHES",{},3e3)])}));case"PANEL_RESIZE_WINDOW":if(!U.tabIds.panel)throw new Error("Panel not available");return r.a.tabs.get(U.tabIds.panel).then((function(e){return r.a.windows.update(e.windowId,Object(o.pick)(["width","height"],L({},t.size,{width:t.size.width,height:t.size.height})))}));case"PANEL_UPDATE_BADGE":var ee={play:J,record:q,inspect:z}[t.type];if(!ee)throw new Error("unknown type for updating badge, '"+t.type+"'");return ee(!t.clear,t);case"PANEL_NOTIFY_AUTO_PAUSE":return r.a.notifications.create({type:"basic",iconUrl:"./logo.png",title:"Replay paused!",message:"Auto paused by command"}),!0;case"PANEL_NOTIFY_BREAKPOINT":return r.a.notifications.create({type:"basic",iconUrl:"./logo.png",title:"Replay paused!",message:"Auto paused by breakpoint"}),!0;case"PANEL_NOTIFY_ECHO":return it=t.text,r.a.notifications.create({type:"basic",iconUrl:"./logo.png",title:"Echo",message:it}),!0;case"PANEL_CLOSE_ALL_WINDOWS":return U.closingAllWindows=!0,se().catch((function(e){c.a.warn("Error in log => RPA closing: ",e.message)})).then((function(){return r.a.windows.getAll().then((function(e){return Promise.all(e.map((function(e){return r.a.windows.remove(e.id)})))})),!0}));case"PANEL_CURRENT_PLAY_TAB_INFO":return X().then((function(e){return{url:e.url,title:e.title}}));case"PANEL_MINIMIZE_ALL_WINDOWS_BUT_PANEL":var re=U.tabIds.panel?r.a.tabs.get(U.tabIds.panel):Promise.resolve(),ce=r.a.windows.getAll();return Promise.all([re,ce]).then((function(e){var t=k(e,2),n=t[0],o=t[1],i=n?o.filter((function(e){return e.id!==n.windowId})):o;return Promise.all(i.map((function(e){return r.a.windows.update(e.id,{state:"minimized"})})))})).then((function(){return Object(o.delay)((function(){return!0}),500)}));case"PANEL_MINIMIZE_ALL_WINDOWS":return r.a.windows.getAll().then((function(e){return Promise.all(e.map((function(e){return r.a.windows.update(e.id,{state:"minimized"})}))).then((function(){return Object(o.delay)((function(){return!0}),500)}))}));case"PANEL_BRING_PANEL_TO_FOREGROUND":return K().then((function(){return!0}));case"PANEL_BRING_PLAYING_WINDOW_TO_FOREGROUND":return X().then((function(e){return Object(E.activateTab)(e.id,!0)})).catch((function(e){return K()})).then((function(){return!0}));case"PANEL_RESIZE_PLAY_TAB":return X().then((function(e){return Object(v.resizeViewportOfTab)(e.id,t)}));case"PANEL_SELECT_AREA_ON_CURRENT_PAGE":return G().then((function(e){return Object(E.activateTab)(U.tabIds.toPlay,!0),e.ask("SELECT_SCREEN_AREA")})).catch((function(e){throw c.a.error(e.stack),new Error("Not able to take screenshot on the current tab")}));case"PANEL_SELECT_AREA_ON_DESKTOP":var de=function(){return Object(S.getNativeCVAPI)().captureDesktop({path:void 0}).then((function(e){return Object(_.runInDesktopScreenshotEditor)({type:P.DesktopScreenshot.RequestType.Capture,data:{image:{source:P.DesktopScreenshot.ImageSource.CV,path:e}}})}))},he=function(){return Object(N.getNativeScreenCapture)().captureDesktop().then((function(e){return Object(S.getNativeCVAPI)().readFileAsDataURL(e,!0)}))};return Promise.all([d.default.get("config").then((function(e){return e.useDesktopScreenCapture})),Object(M.getXScreenCapture)().sanityCheck().catch((function(){return!1}))]).then((function(e){var t=k(e,2),n=t[0],r=t[1];return n&&r})).then((function(e){return(e?he:de)().then((function(e){return Y().then((function(t){return t.ask("ADD_VISION_IMAGE",{dataUrl:e})}))}))}));case"PANEL_CLEAR_VISION_RECTS_ON_PLAYING_PAGE":return G().then((function(e){return Promise.all([e.ask("CLEAR_VISION_RECTS",{},3e3),e.ask("CLEAR_OCR_MATCHES",{},3e3)])}));case"PANEL_HIDE_VISION_HIGHLIGHT":return G().then((function(e){return e.ask("HIDE_VISION_RECTS",{},3e3)}));case"PANEL_SHOW_VISION_HIGHLIGHT":return G().then((function(e){return e.ask("SHOW_VISION_RECTS",{},3e3)}));case"PANEL_SEARCH_VISION_ON_PLAYING_PAGE":var fe=t.visionFileName,ge=t.minSimilarity,me=t.searchArea,pe=void 0===me?"full":me,we=t.storedImageRect,ye=t.command,ve=t.cvScope,be=ye.extra||{},Se=!!be.relativeVisual,Ee="boolean"==typeof be.relativeVisual?be.relativeVisual:/_relative\.png$/i.test(fe),_e=Object(o.dpiFromFileName)(fe)||96,Pe=Object(o.getScreenDpi)(),Te=_e/Pe,Ie=te(),xe=function(e){return Ie.then((function(t){var n=t.getVisionStorage();return n.exists(e).then((function(t){if(!t)throw new Error("Error #121: "+ye.cmd+": No input image found for file name '"+e+"'");return n.read(e,"DataURL")}))}))};if(ge<.1||ge>1)throw new Error("confidence should be between 0.1 and 1.0");return function(){switch(ve){case"desktop":var e="rect"!==pe&&!/\.png/i.test(pe)||!we;return Object(I.getXDesktop)().sanityCheck().then((function(){return xe(fe)})).then((function(e){return Object(S.getNativeCVAPI)().getImageFromDataUrl(e,_e)})).then((function(t){var n=e?void 0:{x:window.devicePixelRatio*we.x,y:window.devicePixelRatio*we.y,width:window.devicePixelRatio*we.width,height:window.devicePixelRatio*we.height};return Object(S.getNativeCVAPI)().searchDesktopWithGuard({pattern:t,options:{searchArea:n,minSimilarity:ge,enableGreenPinkBoxes:Ee,requireGreenPinkBoxes:Se,enableHighDpi:!0,allowSizeVariation:!0,saveCaptureOnDisk:!0,limitSearchArea:!e}}).then((function(e){return Object(S.getNativeCVAPI)().readFileAsDataURL(e.capturePath,!0).then((function(t){return ie(t).then((function(){return Object(S.convertImageSearchResult)(e,1/window.devicePixelRatio,n)}))}))}))}));case"browser":default:return Promise.all([xe(fe),ae({searchArea:pe,storedImageRect:we,dpiScale:Te})]).then((function(e){var t=k(e,2),n=t[0],r=t[1],o=r.dataUrl,i=r.offset,a=r.viewportOffset;return Object(p.searchImage)({patternImageUrl:n,targetImageUrl:o,minSimilarity:ge,enableGreenPinkBoxes:Ee,requireGreenPinkBoxes:Se,allowSizeVariation:!0,scaleDownRatio:Te*window.devicePixelRatio,pageOffsetX:i.x||0,pageOffsetY:i.y||0,viewportOffsetX:a.x||0,viewportOffsetY:a.y||0}).then((function(e){return e.map((function(e){return{matched:e,reference:null}}))}))}))}}().then((function(e){return{regions:e,imageInfo:{source:P.DesktopScreenshot.ImageSource.Storage,path:Object(o.ensureExtName)(".png",Object(A.isCVTypeForDesktop)(ve)?a.LAST_DESKTOP_SCREENSHOT_FILE_NAME:a.LAST_SCREENSHOT_FILE_NAME)}}}));case"PANEL_GET_PIXEL_COLOR_IN_SCREENSHOT":var Ce=t.type,Ae=t.offset;return function(){switch(Ce){case"browser":var e=U.tabIds.toPlay;return Object(E.activateTab)(e,!0).then((function(){return Object(o.delay)((function(){}),j)})).then((function(){return Object(l.c)(e,Object(T.isFirefox)()?1:1/window.devicePixelRatio)})).then((function(e){return oe(e),e}));case"desktop":var t=Object(S.getNativeCVAPI)();return t.captureDesktop({path:void 0}).then((function(e){return t.readFileAsDataURL(e,!0)})).then((function(e){return ie(e),e}));default:throw new Error("Unsupported type: "+Ce)}}().then((function(e){return Object(T.getPixel)({dataUrl:e,x:Ae.x,y:Ae.y})}));case"PANEL_CAPTURE_IMAGE":var Oe=t.searchArea,Re=t.storedImageRect,De=t.scaleDpi;if(t.isDesktop){var Ne=Object(S.getNativeCVAPI)();return Ne.captureDesktop({path:void 0}).then((function(e){return Ne.readFileAsDataURL(e,!0)})).then((function(e){return function(e){switch(Oe){case"rect":if(!Re)throw new Error("storedImageRect is required");return Object(T.subImage)(e,Object(T.scaleRect)(Re,window.devicePixelRatio)).then((function(e){return{dataUrl:e,offset:{x:Re.x,y:Re.y}}}));default:return Promise.resolve({dataUrl:e,offset:{x:0,y:0}})}}(e).then((function(t){var n=t.dataUrl,r=t.offset;return Promise.all([oe(n),ie(e)]).then((function(){return{dataUrl:n,offset:r,viewportOffset:r,scale:1/window.devicePixelRatio}}))}))}))}return ae({searchArea:Oe,storedImageRect:Re,dpiScale:De?96/Object(o.getScreenDpi)():1});case"PANEL_SCREENSHOT_PAGE_INFO":return G().then((function(e){return e.ask("SCREENSHOT_PAGE_INFO",{},3e3)}));case"PANEL_TIMEOUT_STATUS":return le(t.timeout,t.type),!0;case"PANEL_CLEAR_TIMEOUT_STATUS":return clearInterval(U.timer),!0;case"PANEL_TOGGLE_HIGHLIGHT_VIEWPORT":return G().then((function(e){return e.ask("TOGGLE_HIGHLIGHT_VIEWPORT",t,3e3)}));case"PANEL_DISABLE_DOWNLOAD_BAR":return r.a.downloads.setShelfEnabled(!1),Object(o.delay)((function(){return!0}),1e3);case"PANEL_ENABLE_DOWNLOAD_BAR":return r.a.downloads.setShelfEnabled(!0),Object(o.delay)((function(){return!0}),1e3);case"PANEL_GET_VIEWPORT_RECT_IN_SCREEN":return Promise.all([G(),X().then((function(e){return r.a.tabs.getZoom(e.id)}))]).then((function(e){var t=k(e,2),n=(t[0],t[1]);return G().then((function(e){return e.ask("GET_VIEWPORT_RECT_IN_SCREEN",{zoom:n})}))}));case"PANEL_XCLICK_NEED_CALIBRATION":var Me=U.xClickNeedCalibrationInfo,ke=function(e,t){return o.and.apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}("id, top, left, width, height, activeTabId".split(/,\s*/g).map((function(n){return e[n]===t[n]}))))};return X().then((function(e){if(!e)throw new Error("no play tab found for calibration");return r.a.windows.get(e.windowId).then((function(t){var n=function(e,t){return{id:e.id,top:e.top,left:e.left,width:e.width,height:e.height,activeTabId:t}}(t,e.id);return c()("CALIBRATION NEED???",Me,n),U.xClickNeedCalibrationInfo=n,!ke(n,Me||{})}))}));case"PANEL_CLOSE_CURRENT_TAB_AND_SWITCH_TO_LAST_PLAYED":return X().then((function(e){return r.a.windows.get(e.windowId,{populate:!0}).then((function(t){if(t.tabs.length<2)return!0;var n=(t.tabs.findIndex((function(t){return t.id===e.id}))-1+t.tabs.length)%t.tabs.length,i=t.tabs[n],a=U.tabIds.lastPlay?r.a.tabs.get(U.tabIds.lastPlay).catch((function(){return i})):Promise.resolve(i);return r.a.tabs.remove(e.id).then((function(){return a})).then((function(e){return Object(E.activateTab)(e.id)})).then((function(){return Object(o.delay)((function(){}),500)})).then((function(){return!0}))}))}));case"CS_LOAD_URL":var Le=t.sender.tab.id,Fe=t.url;return Object(E.getTab)(Le).then((function(e){var t=function(){try{return new URL(Fe,e.url).toString()}catch(e){return Fe}}();return Object(E.updateUrlForTab)(Le,t).then((function(){return!0}))}));case"CS_STORE_SCREENSHOT_IN_SELECTION":var je=t.rect,Ue=t.devicePixelRatio,Be=t.fileName,He=t.sender.tab.id;return Object(b.getIpcCache)().get(He).then((function(e){return Object(E.activateTab)(U.tabIds.toPlay,!0).then((function(){return Object(o.delay)((function(){}),j)})).then((function(){return Object(l.d)(U.tabIds.toPlay,{rect:je,devicePixelRatio:Ue},{startCapture:function(){return e.ask("START_CAPTURE_FULL_SCREENSHOT",{hideScrollbar:!1})},endCapture:function(t){return e.ask("END_CAPTURE_FULL_SCREENSHOT",{pageInfo:t})},scrollPage:function(t){return e.ask("SCROLL_PAGE",{offset:t})}})})).then((function(e){return te().then((function(t){return t.getScreenshotStorage().overwrite(Be,Object(o.dataURItoBlob)(e)).then((function(){return W().then((function(e){return e.ask("RESTORE_SCREENSHOTS")})),Be}))}))}))}));case"CS_SCREEN_AREA_SELECTED":var Ve=t.rect,Ge=t.devicePixelRatio,We=t.sender.tab.id;return c()("CS_SCREEN_AREA_SELECTED",Ve,Ge,We),Object(l.e)(t.sender.tab.id,{rect:Ve,devicePixelRatio:Ge}).then((function(e){return c()("CS_SCREEN_AREA_SELECTED","got reuslt",e.length),Y().then((function(t){return t.ask("ADD_VISION_IMAGE",{dataUrl:e})}))})).catch((function(e){throw c.a.error(e.stack),e}));case"CS_DONE_INSPECTING":return c()("done inspecting..."),U.status=a.APP_STATUS.NORMAL,z(!1),ue(null,!0,!0),Object(E.activateTab)(U.tabIds.panel,!0),W().then((function(e){return e.ask("INSPECT_RESULT",t)}));case"CS_ACTIVATE_ME":switch(U.status){case a.APP_STATUS.INSPECTOR:if(!U.tabIds.toInspect)return U.tabIds.toInspect=t.sender.tab.id,setTimeout((function(){Object(b.getIpcCache)().get(U.tabIds.toInspect).then((function(e){return e.ask("SET_STATUS",{status:a.CONTENT_SCRIPT_STATUS.INSPECTING})}))}),0),!0}return!1;case"CS_RECORD_ADD_COMMAND":var Xe=!1;return U.status===a.APP_STATUS.RECORDER&&(U.tabIds.toRecord||(Xe=!0,U.tabIds.toRecord=U.tabIds.firstRecord=t.sender.tab.id),U.tabIds.toRecord===t.sender.tab.id&&("pullback"===t.cmd?(U.pullback=!0,setTimeout((function(){U.pullback=!1}),2e3),!1):(setTimeout((function(){Object(b.getIpcCache)().get(U.tabIds.toRecord).then((function(e){return e.ask("SET_STATUS",{status:a.CONTENT_SCRIPT_STATUS.RECORDING})}))}),0),Object(o.delay)((function(){}),1e3).then((function(){return W()})).then((function(e){return Xe&&e.ask("RECORD_ADD_COMMAND",{cmd:"open",target:t.url}),U.pullback&&(t.cmd=t.cmd.replace("AndWait",""),U.pullback=!1),e.ask("RECORD_ADD_COMMAND",t)})).then((function(){return d.default.get("config")})).then((function(e){e.recordNotification&&U.status===a.APP_STATUS.RECORDER&&Z(t)})).then((function(){return!0})))));case"CS_CLOSE_OTHER_TABS":var Ke=t.sender.tab.id;return r.a.tabs.get(Ke).then((function(e){return r.a.tabs.query({windowId:e.windowId}).then((function(e){return e.filter((function(e){return e.id!==Ke}))})).then((function(e){return r.a.tabs.remove(e.map((function(e){return e.id})))}))})).then((function(){return!0}));case"CS_CLOSE_CURRENT_TAB":var Ye=t.sender.tab.id;U.disableHeartBeat=!0,U.pendingPlayingTab=!0;var $e=function(e){return r.a.tabs.remove(Ye).then((function(){return Object(o.delay)((function(){return Object(E.getCurrentTab)(e)}),1e3)}))},qe=function(e){var t=function(){return r.a.tabs.get(U.tabIds.panel).then((function(e){return e.windowId}))},n=function(){return t().then((function(e){return r.a.windows.update(e,{state:"normal"})}))};return t().then((function(e){return r.a.windows.update(e,{state:"minimized"})})).then((function(){return Object(o.delay)((function(){}),1e3)})).then(e).then((function(e){return n(),e}),(function(e){throw n(),e}))};return Object(o.delay)((function(){r.a.tabs.get(Ye).then((function(e){return r.a.windows.get(e.windowId,{populate:!0}).then((function(t){return 1!==t.tabs.length?$e(e.windowId):Object(E.getCurrentTab)().then((function(e){return e&&e.id!==U.tabIds.panel?$e().then((function(e){return e&&e.id===U.tabIds.panel?qe(E.getCurrentTab):e})):qe($e)}))}))})).catch((function(e){c.a.error(e)})).then((function(e){c()("getCurrentTab - ",e);var t=!!e&&!!e.id,n=t&&e.id===U.tabIds.panel;U.tabIds.toPlay=t&&!n?e.id:null})).catch((function(){})).then((function(){c()("resetting pendingPlayingTab"),U.pendingPlayingTab=!1}))}),200),!0;case"CS_SELECT_WINDOW":var ze=t.sender.tab.id,Je=Object(o.splitIntoTwo)("=",t.target),Ze=k(Je,2),Qe=Ze[0],et=Ze[1];if(!et)throw new Error("invalid window locator, '"+t.target+"'");var tt=void 0;switch(Qe.toLowerCase()){case"title":tt=r.a.tabs.query({title:et});break;case"tab":if(/^\s*open\s*$/i.test(et))tt=r.a.tabs.get(U.tabIds.toPlay).then((function(e){return r.a.tabs.create({url:t.value,windowId:e.windowId})})).then((function(e){return[e]}));else{var nt=parseInt(et,10);if(isNaN(nt))throw new Error("invalid tab offset, '"+et+"'");tt=r.a.tabs.get(U.tabIds.firstPlay).then((function(e){return r.a.tabs.query({windowId:e.windowId,index:e.index+nt})}))}break;default:throw new Error("window locator type '"+Qe+"' not supported")}return tt.then((function(e){if(0===e.length)throw new Error("failed to find the tab with locator '"+t.target+"'");return e[0]})).then((function(e){return c()("selectWindow, got tab",e),Object(b.getIpcCache)().get(e.id,3e4).catch((function(e){if(/tab=\s*open\s*/i.test(t.target))throw new Error("To open a new tab, a valid URL is needed");throw e})).then((function(e){return c()("selectWindow, got ipc",e),e.ask("DOM_READY",{}).then((function(){return e.ask("SET_STATUS",{status:a.CONTENT_SCRIPT_STATUS.PLAYING}),!0}))})).then((function(){c()("selectWindow, set orignial to normal"),Object(b.getIpcCache)().get(ze).then((function(e){return e.ask("SET_STATUS",{status:a.CONTENT_SCRIPT_STATUS.NORMAL})}))})).then((function(){return U.tabIds.lastPlay=U.tabIds.toPlay,U.tabIds.toPlay=e.id,Object(E.activateTab)(e.id)}))})).catch((function(e){throw c.a.error(e.stack),e}));case"CS_CAPTURE_SCREENSHOT":return Object(E.activateTab)(U.tabIds.toPlay,!0).then((function(){return Object(o.delay)((function(){}),j)})).then((function(){return te().then((function(e){return Object(l.g)(e.getScreenshotStorage(),U.tabIds.toPlay,t.fileName)}))}));case"CS_CAPTURE_FULL_SCREENSHOT":return Object(E.activateTab)(U.tabIds.toPlay,!0).then((function(){return Object(o.delay)((function(){}),j)})).then(G).then((function(e){return te().then((function(n){return Object(l.f)(n.getScreenshotStorage(),U.tabIds.toPlay,t.fileName,{startCapture:function(){return e.ask("START_CAPTURE_FULL_SCREENSHOT",{},3e3)},endCapture:function(t){return e.ask("END_CAPTURE_FULL_SCREENSHOT",{pageInfo:t},3e3)},scrollPage:function(t){return e.ask("SCROLL_PAGE",{offset:t},3e3)}})}))}));case"CS_TIMEOUT_STATUS":return W().then((function(e){return e.ask("TIMEOUT_STATUS",t)}));case"CS_DELETE_ALL_COOKIES":var rt=t.url;return r.a.cookies.getAll({url:rt}).then((function(e){var t=e.map((function(e){return r.a.cookies.remove({url:""+rt+e.path,name:e.name})}));return Promise.all(t)}));case"CS_SET_FILE_INPUT_FILES":return Object(h.a)({tabId:t.sender.tab.id,selector:t.selector,files:t.files});case"CS_ON_DOWNLOAD":Object(f.a)().prepareDownload(t.fileName,{wait:!!t.wait,timeout:t.timeout,timeoutForStart:t.timeoutForStart});return!0;case"CS_INVOKE":return d.default.get("config").then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(t.testCase,t.testSuite,t.testCase&&t.testCase.from||t.testSuite&&t.testSuite.from);switch(n){case"bookmark":if(!e.allowRunFromBookmark)throw new Error("[Message from RPA] Error #102: To run a macro or a test suite from bookmarks, you need to allow it in the UI.Vision RPA settings first");break;case"html":var r=/^file:\/\//.test(t.sender.url),o=/^https?:\/\//.test(t.sender.url);if(r&&!e.allowRunFromFileSchema)throw new Error("Error #103: To run test suite from local file, enable it in UI.Vision RPA settings first");if(o&&!e.allowRunFromHttpSchema)throw new Error("Error #104: To run test suite from public website, enable it in UI.Vision RPA settings first");break;default:throw new Error("unknown source not allowed")}return Y({params:{from:n}}).then((function(e){return t.testCase?e.ask("RUN_TEST_CASE",{testCase:t.testCase,options:t.options}):!t.testSuite||e.ask("RUN_TEST_SUITE",{testSuite:t.testSuite,options:t.options})}))}));case"CS_IMPORT_AND_INVOKE":var ot=t.from;return d.default.get("config").then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=/^file:\/\//.test(t.sender.url),r=/^https?:\/\//.test(t.sender.url);if(n&&!e.allowRunFromFileSchema)throw new Error("Error #105: To run macro from local file, enable it in RPA settings first");if(r&&!e.allowRunFromHttpSchema)throw new Error("Error #105: To run macro from public website, enable it in the RPA settings first");return Y({params:{from:ot}}).then((function(e){return e.ask("IMPORT_AND_RUN",t)}))}));case"CS_ADD_LOG":return W().then((function(e){return e.ask("ADD_LOG",t)}));case"CS_OPEN_PANEL_SETTINGS":return Y({params:{settings:!0}}).then((function(e){return e.ask("OPEN_SETTINGS")})).catch((function(e){console.error(e)})),!0;case"DESKTOP_EDITOR_ADD_VISION_IMAGE":return Y().then((function(e){return e.ask("ADD_VISION_IMAGE",{dataUrl:t.dataUrl,requireRename:!0})}));case"SET_CLIPBOARD":return u.a.set(t.value),!0;case"GET_CLIPBOARD":return u.a.get();case"TIMEOUT":return c()("TIMEOUT",t.timeout,t.id),Object(o.delay)((function(){return t.id}),t.timeout);default:return"unknown"}var it,at,st,ct},he=function(e,t){Object(x.getKantuMigrationService)().runAll(e,t)};r.a.browserAction.onClicked.addListener((function(){r.a.storage.local.get("upgrade_not_viewed").then((function(e){return"not_viewed"!==e.upgrade_not_viewed})).then((function(e){return e?K():(r.a.browserAction.setBadgeText({text:""}),r.a.storage.local.set({upgrade_not_viewed:""}),r.a.tabs.create({url:m.a.urlAfterUpgrade}))}))})),r.a.tabs.onRemoved.addListener((function(e,t){if(U.status===a.APP_STATUS.PLAYER&&e===U.tabIds.toPlay){if(U.pendingPlayingTab)return;return r.a.windows.get(t.windowId,{populate:!0}).then((function(e){return(e?Promise.resolve(e.tabs.find((function(e){return e.active}))):Object(E.getCurrentTab)().then((function(e){return e?e.id===U.tabIds.panel?null:e:null}))).then((function(e){e&&e.id&&(U.tabIds.toPlay=e.id)}))}))}e!==U.tabIds.panel||U.closingAllWindows||se()})),r.a.tabs.onUpdated.addListener((function(e,t,n){n.active&&function(e){return r.a.tabs.get(e).then((function(t){if(!t.active)return!1;switch(U.status){case a.APP_STATUS.NORMAL:return r.a.windows.get(t.windowId).then((function(e){return e.focused}));case a.APP_STATUS.PLAYER:return e===U.tabIds.toPlay;case a.APP_STATUS.RECORDER:return e===U.tabIds.toRecord;default:throw new Error("isTabActiveAndFocused: unknown app status, '"+U.status+"'")}})).catch((function(e){return!1}))}(e).then((function(t){if(t)return Q(e)}))})),r.a.windows.onFocusChanged.addListener((function(e){r.a.tabs.query({windowId:e,active:!0}).then((function(e){0!==e.length&&Object(b.getIpcCache)().get(e[0].id,100).then((function(e){return e.ask("TAB_ACTIVATED",{})}),(function(e){return"Comment: ingore this error"}))}))})),r.a.tabs.onActivated.addListener((function(e){if(e.tabId!==U.tabIds.panel)switch(U.tabIds.lastActivated=U.tabIds.lastActivated.concat(e.tabId).filter((function(e){return e!==U.tabIds.panel})).slice(-2),Object(b.getIpcCache)().get(e.tabId,100).then((function(e){return e.ask("TAB_ACTIVATED",{})}),(function(e){return"Comment: ingore this error"})),Q(e.tabId),U.status){case a.APP_STATUS.NORMAL:setTimeout((function(){r.a.tabs.get(e.tabId).then((function(t){-1===t.url.indexOf(r.a.extension.getURL(""))&&(c()("in tab activated, set toPlay to ",e),U.tabIds.lastPlay=U.tabIds.toPlay,U.tabIds.toPlay=U.tabIds.firstPlay=e.tabId)}))}),100);break;case a.APP_STATUS.RECORDER:Object(b.getIpcCache)().get(e.tabId,5e3).then((function(e){return Object(o.delay)((function(){return e}),2e3)})).then((function(e){return e.ask("SET_STATUS",{status:a.CONTENT_SCRIPT_STATUS.RECORDING})})).then((function(){return V().then((function(e){e.ask("SET_STATUS",{status:a.CONTENT_SCRIPT_STATUS.NORMAL})}))})).then((function(){var t=U.tabIds.firstRecord,n=e.tabId;return Promise.all([r.a.tabs.get(t),r.a.tabs.get(n)]).then((function(t){var n=k(t,2),r=n[0],o=n[1],i=[];return U.tabIds.toRecord=e.tabId,r.windowId===o.windowId&&i.push("tab="+(o.index-r.index)),i.push("title="+o.title),{target:i[0],targetOptions:i}}))})).then((function(e){var t=L({cmd:"selectWindow"},e);return W().then((function(e){return e.ask("RECORD_ADD_COMMAND",t)})).then((function(e){e&&Z(t)}))})).catch((function(e){c.a.error(e.stack)}))}})),Object(i.bgInit)((function(e,t,n){Object(b.getIpcCache)().has(e,t)||(c()("connect cs ipc",e,t,n),Object(b.getIpcCache)().set(e,n,t),n.onAsk(de))})),void 0!==e&&(r.a.runtime.setUninstallURL(m.a.urlAfterUninstall),r.a.runtime.onInstalled.addListener((function(e){var t=e.reason;switch(e.previousVersion,t){case"install":return d.default.get("config").then((function(e){return d.default.set("config",L({},e,{showTestCaseTab:!1}))})),r.a.tabs.create({url:m.a.urlAfterInstall});case"update":return setTimeout((function(){he("4.0.1",r.a.runtime.getManifest().version)}),0),r.a.browserAction.setBadgeText({text:"NEW"}),r.a.browserAction.setBadgeBackgroundColor({color:"#4444FF"}),r.a.storage.local.set({upgrade_not_viewed:"not_viewed"})}}))),r.a.windows.getCurrent().then((function(e){return r.a.tabs.query({active:!0,windowId:e.id}).then((function(e){return!(!e||!e.length||(c()("in initPlayTab, set toPlay to",e[0]),U.tabIds.lastPlay=U.tabIds.toPlay,U.tabIds.toPlay=U.tabIds.firstPlay=e[0].id,0))}))})),Object(f.a)().onCountDown((function(e){W().then((function(t){t.ask("TIMEOUT_STATUS",L({},e,{type:"download"}))}))})),Object(f.a)().onDownloadComplete((function(e){W().then((function(t){t.ask("DOWNLOAD_COMPLETE",e)}))})),ce=function(e){var t=e?m.a.icons.inverted:m.a.icons.normal;r.a.browserAction.setIcon({path:t}),U.tabIds.panel&&W().then((function(t){return t.ask("PROXY_UPDATE",{proxy:e})})).catch((function(e){return c.a.warn(e)}))},Object(O.getProxyManager)().getProxy().then(ce),Object(O.getProxyManager)().onChange(ce),Object(D.getContextMenuService)().destroyMenus(),window.clip=u.a}.call(this,n(68))},1080:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1081);class o{constructor(e,t,n){this.jobObject=r.JobFactory.create(e,t),this.callback=n}get job(){return this.jobObject}}t.WorkerConnection=class{constructor(e,t){this.queue=new Array,this.messageHandler=t,this.worker=new Worker(e),this.worker.onmessage=this.handleWorkerCallback.bind(this)}handleWorkerCallback(e){const t=e.data;if(1===t.type){const e=t.data;let n=void 0;for(let t=0;t<this.queue.length;++t){const r=this.queue[t];if(r.job.id===e.id){n=r.callback,this.queue.splice(t,1);break}}const r=Math.max(0,e.finishTime-e.startTime);console.log(`Job #${e.id} completed in ${r.toFixed(0)} ms (excluding callback overhead).`),n&&n(e.result)}else this.messageHandler(t)}postMessage(e){this.worker.postMessage(e)}postJob(e,t,n){const r=new o(e,t,n);this.queue.push(r),this.postMessage({type:1,data:r.job})}postJobAsync(e,t){const n=this;return new Promise((r,o)=>{n.postJob(e,t,e=>{r(e)})})}}},1081:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static create(e,t){return{id:r.nextId++,type:e,startTime:performance.now(),finishTime:0,args:t,result:void 0}}static complete(e,t){return{id:e.id,type:e.type,startTime:e.startTime,finishTime:performance.now(),args:e.args,result:t}}}t.JobFactory=r,r.nextId=1},1082:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(1083);t.ImageHelper=class{static loadImageAsync(e){return new Promise((t,n)=>{const r=new Image;r.onload=()=>{t(r)},r.onerror=()=>{n()},r.src=e})}static loadImageDataAsync(e){return r(this,void 0,void 0,(function*(){const t=yield this.loadImageAsync(e);return this.convertImageToImageData(t)}))}static convertImageDataToDataUrl(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");if(!n)throw new Error("Cannot acquire 2D context.");return n.putImageData(e,0,0),t.toDataURL()}static convertImageToImageData(e){const t=document.createElement("canvas");t.width=e.naturalWidth,t.height=e.naturalHeight;const n=t.getContext("2d");if(!n)throw new Error("Cannot acquire 2D context.");return n.drawImage(e,0,0),n.getImageData(0,0,t.width,t.height)}static distortImage(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");if(!n)throw new Error("Cannot acquire 2D context.");n.putImageData(e,0,0);const r=t.width*t.height,i=Math.max(10,Math.floor(.01*r*Math.random()));for(let e=0;e<i;++e){const e=o.MathHelper.randomRange(0,t.width),r=o.MathHelper.randomRange(0,t.height),i=o.MathHelper.randomRange(1,20)/10,a=o.MathHelper.randomRange(1,20)/10;n.fillStyle=o.MathHelper.randomColor(),n.fillRect(e,r,i,a)}return n.getImageData(0,0,t.width,t.height)}static getImageDataRegion(e,t){const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d");if(!r)throw new Error("Cannot acquire 2D context.");return r.putImageData(e,0,0),r.getImageData(t.left,t.top,t.right-t.left,t.bottom-t.top)}}},1083:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static randomRange(e,t){return Math.floor(e+Math.random()*(t-e))}static randomColor(){return`rgba(${r.randomRange(0,256)}, ${r.randomRange(0,256)}, ${r.randomRange(0,256)}, ${r.randomRange(1,256)/256})`}}t.MathHelper=r},1084:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(1085),i=r(n(10)),a=n(64),s=n(65);t.openPageInIframe=o.createIframe,t.askPageWithIframe=e=>{const n=t.openPageInIframe({url:e.url,width:e.width,height:e.height,ipcTimeout:e.ipcTimeout,domReady:e.domReady,onLoad:e.onLoad});return n.ask(e.cmd,e.args).then(e=>(setTimeout(()=>n.destroy()),e))},t.openPageInTab=e=>{const t=t=>e.popup?i.default.windows.create({type:"popup",url:t,width:Math.round(e.width||screen.availWidth),height:Math.round(e.height||screen.availHeight),left:Math.round(e.left||0),top:Math.round(e.top||0)}).then(e=>e.tabs[0]):i.default.tabs.create({url:t}),{url:n,tabId:r,domReady:o}=e,c=(e.tabId?((e,n)=>(e=>i.default.tabs.get(e).then(e=>!!e).catch(e=>!1))(e).then(r=>r?i.default.tabs.update(e,{url:n}):t(n)))(r,n):t(n)).then(t=>{const n=a.getIpcCache(),r=o?n.domReadyGet(t.id,2e4,o):n.get(t.id,2e4);return(e.focus?s.activateTab(t.id,!0):Promise.resolve()).then(()=>r).then(n=>Object.assign(Object.assign({},n),{getTabId:()=>t.id,getTab:()=>i.default.tabs.get(t.id),destroy:()=>{n.destroy(),e.tabId||e.keep||i.default.tabs.remove(t.id)}}))});return{destroy:()=>{c.then(e=>e.destroy())},ask:(...e)=>c.then(t=>t.ask(...e)),onAsk:(...e)=>{c.then(t=>t.onAsk(...e))},getTab:()=>c.then(e=>e.getTab()),getTabId:()=>c.then(e=>e.getTabId())}},t.askPageWithTab=e=>{const n=t.openPageInTab({url:e.url,tabId:e.tabId,ipcTimeout:e.ipcTimeout,domReady:e.domReady});return n.ask(e.cmd,e.args).then(e=>(setTimeout(()=>n.destroy(),0),e))},t.askPageWithFixedTab=(()=>{let e=void 0;return n=>{const r=t.openPageInTab({url:n.url,tabId:n.tabId||e,keep:!0,ipcTimeout:n.ipcTimeout,domReady:n.domReady});return r.getTabId().then(t=>(e=t,r.ask(n.cmd,n.args).then(e=>(setTimeout(()=>r.destroy(),0),e))))}})()},1085:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(63),o=n(184),i=n(373),a=n(12),s=r.postMessage;t.ipcForIframe=({targetWindow:e=window.top,timeout:t=6e4}={})=>{const n=o.createListenerRegistry(),i=r.onMessage(window,({cmd:e,args:t})=>n.fire("call",{cmd:e,args:t}));return{ask:(n,r)=>s(e,window,{cmd:n,args:r},"*",t),onAsk:e=>{n.add("call",({cmd:t,args:n})=>e(t,n))},destroy:()=>{i()}}},t.createIframe=e=>{const{url:t,width:n,height:c,onLoad:u,domReady:l,ipcTimeout:d=6e4}=e,h=document.createElement("iframe"),f=new Promise((e,r)=>{n&&(h.width=""+n),c&&(h.height=""+c),h.addEventListener("load",()=>{if("function"==typeof u)try{u()}catch(e){}e()}),h.src=t,document.body.appendChild(h)}),g=l?f.then(()=>(e=>a.retry(()=>i.withConsecutive(e,()=>s(h.contentWindow,window,{cmd:"DOM_READY",args:{}},"*",1e3).then(()=>!0,()=>!1)).then(()=>{}),{timeout:d,shouldRetry:e=>!0,retryInterval:1e3})())(l)):f,m=r.onMessage(window,({cmd:e,args:t})=>p(e,t)),p=(e,t)=>w.fire("call",{cmd:e,args:t}),w=o.createListenerRegistry();return{$iframe:h,destroy:()=>{h&&h.remove(),m()},ask:(e,t)=>g.then(()=>s(h.contentWindow,window,{cmd:e,args:t},"*",d)),onAsk:e=>{w.add("call",({cmd:t,args:n})=>e(t,n))}}}},119:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(10),o=n.n(r),i=n(11),a=n.n(i),s=n(4),c=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var d,h=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.activeDownloads=[],this.eventsBound=!1,this.filterActiveDownloads=function(e){t.activeDownloads=t.activeDownloads.filter(e),0===t.activeDownloads.length&&t.unbindEvents()},this.createdListener=function(e){if(t.isActive()){a()("download on created",e);var n=t.activeDownloads.find((function(e){return!e.id}));n&&u(n,u({id:e.id},!n.wait&&n.timeout>0?{}:{timeoutTimer:setTimeout((function(){n.reject(new Error("download timeout "+n.timeout/1e3+"s")),t.filterActiveDownloads((function(e){return n.uid!==e.uid}))}),n.timeout),countDownTimer:setInterval((function(){if(t.countDownHandler){var e=n.past,r=(void 0===e?0:e)+1e3;t.countDownHandler({total:n.timeout,past:r}),u(n,{past:r})}}),1e3)}))}},this.changedListener=function(e){if(t.isActive()){a()("download on changed",e);var n=t.findById(e.id);if(n&&e.state){var r=function(){},i=!1;switch(e.state.current){case"complete":r=function(){return n.resolve(!0)},i=!0,t.completeHandler&&o.a.downloads.search({id:n.id}).then((function(e){var n=c(e,1)[0];n&&t.completeHandler(n)}));break;case"interrupted":r=function(){return n.reject(new Error("download interrupted"))},i=!0}i&&(clearTimeout(n.timeoutTimer),clearInterval(n.countDownTimer),t.filterActiveDownloads((function(t){return t.id!==e.id}))),r()}}},this.determineFileNameListener=function(e,n){if(t.isActive()){a()("download on determine",e);var r=t.findById(e.id);if(r){var o=r.fileName.trim(),i=""===o||"*"===o?null:o;return i?n({filename:i,conflictAction:"uniquify"}):void 0}}}}return l(e,[{key:"isActive",value:function(){return this.activeDownloads.length>0}},{key:"findById",value:function(e){return this.activeDownloads.find((function(t){return t.id===e}))}},{key:"bindEvents",value:function(){this.eventsBound||(o.a.downloads.onCreated.addListener(this.createdListener),o.a.downloads.onChanged.addListener(this.changedListener),o.a.downloads.onDeterminingFilename&&o.a.downloads.onDeterminingFilename.addListener(this.determineFileNameListener),this.eventsBound=!0)}},{key:"unbindEvents",value:function(){this.eventsBound&&(o.a.downloads.onCreated.removeListener&&o.a.downloads.onCreated.removeListener(this.createdListener),o.a.downloads.onChanged.removeListener&&o.a.downloads.onChanged.removeListener(this.changedListener),o.a.downloads.onDeterminingFilename&&o.a.downloads.onDeterminingFilename.removeListener&&o.a.downloads.onDeterminingFilename.removeListener(this.determineFileNameListener),this.eventsBound=!1)}},{key:"reset",value:function(){this.activeDownloads.forEach((function(e){e.timeoutTimer&&clearTimeout(e.timeoutTimer),e.countDownTimer&&clearInterval(e.countDownTimer)})),this.activeDownloads=[],this.unbindEvents()}},{key:"prepareDownload",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.activeDownloads.find((function(e){return!e.id}));if(r)throw new Error("only one not-created download allowed at a time");this.bindEvents();var o=u({timeoutForStart:1e4,timeout:6e4,wait:!1},n),i=new Promise((function(n,r){var a=Math.floor(1e3*Math.random())+1*new Date;setTimeout((function(){t.activeDownloads.push({uid:a,resolve:n,reject:r,fileName:e,promise:i,timeoutForStart:o.timeoutForStart,timeout:o.timeout,wait:o.wait})}),0)}));return i}},{key:"waitForDownloadIfAny",value:function(){var e=this,t=this.activeDownloads.find((function(e){return!e.id}));if(t)return Object(s.until)("download start",(function(){return{pass:!!t.id,result:!0}}),50,t.timeoutForStart).then((function(){return e.waitForDownloadIfAny()}));var n=this.activeDownloads.find((function(e){return e.wait&&e.id}));return n?n.promise.then((function(){return e.waitForDownloadIfAny()})):Promise.resolve(!0)}},{key:"onCountDown",value:function(e){this.countDownHandler=e}},{key:"onDownloadComplete",value:function(e){this.completeHandler=e}},{key:"hasPendingDownload",value:function(){return!!this.activeDownloads.find((function(e){return!e.id}))}}]),e}(),f=(d=void 0,function(){return d||(d=new h),d})},121:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(89),i=r(n(107)),a=n(27),s=n(4),c=n(22),u=r(n(10)),l=n(12);class d extends o.StandardStorage{constructor(e){super({encode:e.encode,decode:e.decode}),this.transformFileName=e=>e;const{extensions:t,shouldKeepExt:n,transformFileName:r,baseDir:o="share"}=e;if(!o||"/"===o)throw new Error(`Invalid baseDir, ${o}`);r&&(this.transformFileName=r),this.baseDir=o,this.extensions=t,this.shouldKeepExt=n,i.default.getDirectory(o,!0)}getLink(e){if(c.isFirefox())return this.read(e,"DataURL");{const t=`filesystem:${u.default.extension.getURL("temporary")}/${this.filePath(e)}`;return Promise.resolve(t+"?"+(new Date).getTime())}}read(e,t){const n=this.filePath(e),r=a.posix.relative(this.dirPath("/"),n);return i.default.readFile(n,t).then(e=>this.decode(e,r,t),t=>{if(-1!==t.message.indexOf("A requested file or directory could not be found"))throw new Error(`File not found: ${e}`);return Promise.reject(t)})}stat(e,t){const n=a.posix.basename(e),r=a.posix.dirname(e),o=t?this.dirPath(e):this.filePath(e),s=a.posix.relative(this.dirPath("/"),o);return i.default.existsStat(o).then(({isFile:e,isDirectory:t})=>e?i.default.getMetadata(o,t).then(i=>({dir:r,name:n,fullPath:o,relativePath:s,isFile:e,isDirectory:t,size:i.size,lastModified:i.modificationTime})):{dir:r,name:n,fullPath:o,relativePath:s,isFile:e,isDirectory:t,size:0,lastModified:new Date(0)})}__list(e="/",t=!1){const n=(e,t)=>this.shouldKeepExt||t?e:this.removeExt(e);return this.ensureBaseDir().then(()=>i.default.list(this.dirPath(e))).then(e=>{const t=e.map(e=>this.stat(e.fullPath,e.isDirectory).then(t=>Object.assign(Object.assign({},t),{name:this.transformFileName(n(t.name,e.isDirectory))})));return Promise.all(t).then(e=>(e.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0),this.totalCount=e.length,this.displayedCount=e.length,e))})}__write(e,t){return this.ensureBaseDir().then(()=>this.remove(e)).catch(()=>{}).then(()=>this.encode(t,e)).then(t=>i.default.writeFile(this.filePath(e,!0),t)).then(()=>{})}__overwrite(e,t){return this.__write(e,t)}__removeFile(e){return i.default.removeFile(this.filePath(e))}__removeEmptyDirectory(e){return i.default.rmdir(this.dirPath(e))}__moveFile(e,t){return i.default.moveFile(this.filePath(e),this.filePath(t,!0)).then(()=>{})}__copyFile(e,t){return i.default.copyFile(this.filePath(e),this.filePath(t,!0)).then(()=>{})}__createDirectory(e){return i.default.getDirectory(this.dirPath(e,!0),!0).then(()=>{})}dirPath(e,t=!1){const n=this.getPathLib(),r=(()=>this.isStartWithBaseDir(e)?e:n.join("/",this.baseDir,e))(),o=n.dirname(r),i=n.basename(r),a=t?s.sanitizeFileName(i):i;return n.join(o,a)}isWin32Path(){return!1}filePath(e,t=!1){const n=a.posix.dirname(e),r=a.posix.basename(e),o=t?s.sanitizeFileName(r):r,i=a.posix.extname(r),c=this.extensions[0],u=i&&i.substr(1).toLowerCase()===c.toLowerCase()?o:o+"."+c;return this.isStartWithBaseDir(n)?a.posix.join(n,this.transformFileName(u)):a.posix.join("/",this.baseDir,n,this.transformFileName(u))}isStartWithBaseDir(e){return 0===e.indexOf("/"+this.baseDir)}ensureBaseDir(){return i.default.ensureDirectory(this.baseDir).then(()=>{})}removeExt(e){const t=a.posix.basename(e),n=a.posix.extname(e),r=t.lastIndexOf(n);return t.substring(0,r)}}t.BrowserFileSystemStandardStorage=d,t.getBrowserFileSystemStandardStorage=l.singletonGetterByKey(e=>e&&e.baseDir||"share",e=>new d(e))},122:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(12);t.EACCES=r.errorClassFactory("EACCES"),t.EEXIST=r.errorClassFactory("EEXIST"),t.EISDIR=r.errorClassFactory("EISDIR"),t.EMFILE=r.errorClassFactory("EMFILE"),t.ENOENT=r.errorClassFactory("ENOENT"),t.ENOTDIR=r.errorClassFactory("ENOTDIR"),t.ENOTEMPTY=r.errorClassFactory("ENOTEMPTY")},123:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(27)),i=n(89),a=n(4),s=n(60),c=n(128),u=n(12);class l extends i.StandardStorage{constructor(e){super({encode:e.encode,decode:e.decode,listFilter:e.listFilter});const{baseDir:t,rootDir:n,extensions:r,shouldKeepExt:o=!1,allowAbsoluteFilePath:i=!1}=e;if(!t||"/"===t)throw new Error(`Invalid baseDir, ${t}`);this.rootDir=n,this.baseDir=t,this.extensions=r,this.shouldKeepExt=o,this.allowAbsoluteFilePath=i,this.fs=s.getNativeFileSystemAPI()}getLink(e){return this.read(e,"DataURL")}read(e,t){const n=this.filePath(e),r=o.default.relative(this.dirPath("/"),n),i=n=>{if(0!==n.errorCode)throw new c.ErrorWithCode(`${e}: `+c.getErrorMessageForCode(n.errorCode),n.errorCode);const o=n.content,i=(()=>{switch(t){case"Text":case"DataURL":return o;case"ArrayBuffer":return a.dataURItoArrayBuffer(o);case"BinaryString":return a.arrayBufferToString(a.dataURItoArrayBuffer(o))}})();return this.decode(i,r,t)};switch(t){case"Text":return this.fs.readAllTextCompat({path:n}).then(i);default:return this.fs.readAllBytesCompat({path:n}).then(i)}}stat(e,t){const n=o.default.dirname(e),r=o.default.basename(e),i=t?this.dirPath(e):this.filePath(e),a=o.default.relative(this.dirPath("/"),i),s={dir:n,name:r,fullPath:i,relativePath:a,isFile:!1,isDirectory:!1,lastModified:new Date(0),size:0};return(t?this.fs.directoryExists({path:i}):this.fs.fileExists({path:i})).then(e=>e?this.fs.getFileSystemEntryInfo({path:i}).then(e=>({dir:n,name:r,fullPath:i,relativePath:a,isFile:!e.isDirectory,isDirectory:e.isDirectory,lastModified:new Date(e.lastWriteTime),size:e.length}),e=>s):s)}__list(e="/",t=!1){return this.ensureBaseDir().then(()=>this.fs.getEntries({brief:t,path:this.dirPath(e),extensions:this.extensions}).then(t=>{const n=t.entries,r=t.errorCode;if(0!==r)throw new c.ErrorWithCode(c.getErrorMessageForCode(r)+`: ${e}`,r);const i=(e,t)=>this.shouldKeepExt||t?e:this.removeExt(e);return n.map(t=>{const n=this.dirPath(e),r=i(t.name,t.isDirectory),a=o.default.join(n,t.name);return{dir:n,name:r,fullPath:a,relativePath:o.default.relative(this.dirPath("/"),a),isFile:!t.isDirectory,isDirectory:t.isDirectory,lastModified:new Date(t.lastWriteTime),size:t.length}})}))}__write(e,t){return this.ensureBaseDir().then(()=>this.encode(t,e)).then(t=>this.fs.writeAllBytes({content:t,path:this.filePath(e,!0)}).then(t=>{if(!t)throw new Error(`Failed to write to '${e}'`)}))}__overwrite(e,t){return this.write(e,t)}__removeFile(e){return this.ensureBaseDir().then(()=>this.fs.deleteFile({path:this.filePath(e)}).then(()=>{}))}__removeEmptyDirectory(e){return this.ensureBaseDir().then(()=>this.fs.removeDirectory({path:this.dirPath(e)}).then(()=>{}))}__moveFile(e,t){return this.ensureBaseDir().then(()=>this.fs.moveFile({sourcePath:this.filePath(e),targetPath:this.filePath(t,!0)}).then(()=>{}))}__copyFile(e,t){return this.ensureBaseDir().then(()=>this.fs.copyFile({sourcePath:this.filePath(e),targetPath:this.filePath(t,!0)}).then(()=>{}))}__createDirectory(e){return this.ensureBaseDir().then(()=>this.fs.createDirectory({path:this.dirPath(e,!0)}).then(()=>{}))}dirPath(e,t=!1){const n=this.getPathLib(),r=(()=>this.isStartWithBaseDir(e)?n.normalize(e):n.normalize(n.join(this.rootDir,this.baseDir,e)))(),o=n.dirname(r),i=n.basename(r),s=t?a.sanitizeFileName(i):i;return n.join(o,s)}filePath(e,t=!1){const n=o.default.dirname(e),r=o.default.basename(e),i=t?a.sanitizeFileName(r):r,s=o.default.extname(r),c=this.extensions[0],u=s&&s.substr(1).toLowerCase()===c.toLowerCase()?i:i+"."+c;return this.isStartWithBaseDir(n)||this.allowAbsoluteFilePath&&this.isAbsoluteUrl(e)?o.default.normalize(o.default.join(n,u)):o.default.normalize(o.default.join(this.rootDir,this.baseDir,n,u))}isWin32Path(){return/^([A-Z]:\\|\/\/|\\\\)/i.test(this.rootDir)}isAbsoluteUrl(e){return this.getPathLib().isAbsolute(e)}isStartWithBaseDir(e){return 0===e.indexOf(this.rootDir)}removeExt(e){const t=o.default.basename(e),n=o.default.extname(e),r=t.lastIndexOf(n);return t.substring(0,r)}ensureBaseDir(){const e=this.fs,t=o.default.normalize(o.default.join(this.rootDir,this.baseDir));return e.directoryExists({path:t}).then(n=>n||e.createDirectory({path:t})).then(()=>{})}}t.NativeFileSystemStandardStorage=l,t.getNativeFileSystemStandardStorage=u.singletonGetterByKey(e=>o.default.join(e.rootDir,e.baseDir),e=>new l(e))},124:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PublicMethodTypes=[1,2,3,4,5,8,9,10,11,12,13,14,15,16,17,18],t.MethodTypeFriendlyNames=["GetVersion","GetFileSystemEntries","GetDirectories","GetFiles","GetFileSystemEntryInfo","GetSpecialFolderPath","DirectoryExists","FileExists","CreateDirectory","RemoveDirectory","CopyFile","MoveFile","DeleteFile","ReadAllText","WriteAllText","AppendAllText","ReadAllBytes","WriteAllBytes","AppendAllBytes","GetMaxFileRange","GetFileSize","ReadFileRange","RunProcess"],t.MethodTypeInvocationNames=["get_version","get_file_system_entries","get_directories","get_files","get_file_system_entry_info","get_special_folder_path","directory_exists","file_exists","create_directory","remove_directory","copy_file","move_file","delete_file","read_all_text","write_all_text","append_all_text","read_all_bytes","write_all_bytes","append_all_bytes","get_max_file_range","get_file_size","read_file_range","run_process"]},125:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(97);class o extends r.NativeMessagingHost{constructor(){super(o.HOST_NAME)}}t.KantuFileAccessHost=o,o.HOST_NAME="com.a9t9.kantu.file_access"},126:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e){this.input=e,this.position=0}getNextByte(){if(this.position>=this.input.length)return r.END;const e=255&this.input[this.position];return++this.position,e}getNextContinuationByte(){const e=this.getNextByte();return 128==(192&e)?63&e:r.ERROR}decodeNext(){if(this.position>=this.input.length)return this.position===this.input.length?r.END:r.ERROR;const e=this.getNextByte();if(0==(128&e))return e;if(192==(224&e)){const t=this.getNextContinuationByte();if(t>=0){const n=(31&e)<<6|t;if(n>=128)return n}}else if(224==(240&e)){const t=this.getNextContinuationByte(),n=this.getNextContinuationByte();if((t|n)>=0){const r=(15&e)<<12|t<<6|n;if(r>=2048&&(r<55296||r>57343))return r}}else if(240==(248&e)){const t=this.getNextContinuationByte(),n=this.getNextContinuationByte(),r=this.getNextContinuationByte();if((t|n|r)>=0){const o=(7&e)<<18|t<<12|n<<6|r;if(o>=65536&&o<=1114111)return o}}return r.ERROR}}r.REPLACEMENT_CHARACTER="",r.END=-1,r.ERROR=-2,function(e){e.isValid=function(e){const t=new r(e);for(;;){switch(t.decodeNext()){case r.END:return!0;case r.ERROR:return!1}}},e.decode=function(e){const t=new r(e);let n="";for(;;){const e=t.decodeNext();if(e===r.END)break;n+=e!==r.ERROR?String.fromCodePoint(e):r.REPLACEMENT_CHARACTER}return n}}(t.utf8||(t.utf8={}))},127:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){const t=new Uint8Array([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47]),n=new Uint8Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);function r(e,t,r){if(r>4)throw new Error("maxLength should be in range [0, 4].");const o=new Uint8Array(4);for(let i=0;i<r;++i){const r=e.charCodeAt(t+i),a=n[r];if(255===a)return;o[i]=a}return(o[0]<<18)+(o[1]<<12)+(o[2]<<6)+(o[3]<<0)}function o(e,t,n){e[t+0]=n>>16&255,e[t+1]=n>>8&255,e[t+2]=255&n}e.encode=function(e){const n=e.length,r=function(e){let t=4*Math.trunc(e/3);return t+=e%3!=0?4:0,t}(n),o=n%3,i=n-o,a=new Uint8Array(r);let s,c=0;for(s=0;s<i;s+=3)a[c+0]=t[(252&e[s])>>2],a[c+1]=t[(3&e[s])<<4|(240&e[s+1])>>4],a[c+2]=t[(15&e[s+1])<<2|(192&e[s+2])>>6],a[c+3]=t[63&e[s+2]],c+=4;switch(s=i,o){case 2:a[c+0]=t[(252&e[s])>>2],a[c+1]=t[(3&e[s])<<4|(240&e[s+1])>>4],a[c+2]=t[(15&e[s+1])<<2],a[c+3]=61,c+=4;break;case 1:a[c+0]=t[(252&e[s])>>2],a[c+1]=t[(3&e[s])<<4],a[c+2]=61,a[c+3]=61,c+=4}return new TextDecoder("ascii").decode(a)},e.decode=function(e){const t=e.length;if(t%4!=0)return;let n=0;t>0&&61==e.charCodeAt(t-1)&&(++n,t>1&&61==e.charCodeAt(t-2)&&++n);const i=-4&t-n,a=new Uint8Array(6*t/8-n);let s,c=0,u=0;for(;c<i;){if(s=r(e,c,4),void 0===s)return;o(a,u,s),c+=4,u+=3}if(n>0){if(s=r(e,c,4-n),void 0===s)return;switch(n){case 1:a[u+0]=s>>16&255,a[u+1]=s>>8&255;break;case 2:a[u+0]=s>>16&255}}return a}}(t.base64||(t.base64={}))},128:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(76),i=n(60),a=r(n(27)),s=n(4),c=n(12);class u extends o.FlatStorage{constructor(e){super({encode:e.encode,decode:e.decode}),this.listFilter=e=>e,this.displayedCount=0,this.totalCount=0;const{baseDir:t,rootDir:n,extensions:r,shouldKeepExt:o=!1,listFilter:a}=e;if(!t||"/"===t)throw new Error(`Invalid baseDir, ${t}`);this.rootDir=n,this.baseDir=t,this.extensions=r,this.shouldKeepExt=o,a&&(this.listFilter=a),this.fs=i.getNativeFileSystemAPI()}getDisplayCount(){return this.displayedCount}getTotalCount(){return this.totalCount}readAll(e="Text",t){return this.list().then(n=>Promise.all(n.map(t=>this.read(t.fileName,e).then(e=>({content:e,fileName:t.fileName})).catch(e=>({fileName:t.fileName,fullFilePath:this.filePath(t.fileName),error:new Error(`Error in parsing ${this.filePath(t.fileName)}:\n${e.message}`)})))).then(e=>{const n=e.filter(e=>e.error);return t&&t(n),e.filter(e=>e.content)}))}getLink(e){return this.read(e,"DataURL")}__list(){return this.ensureDir().then(()=>this.fs.getEntries({path:a.default.join(this.rootDir,this.baseDir),extensions:this.extensions}).then(e=>{const t=e.entries,n=e.errorCode;if(0!==n)throw new l(d(n),n);const r=e=>this.shouldKeepExt?e:this.removeExt(e),i=t.map(e=>({dir:this.baseDir,fileName:r(e.name),lastModified:new Date(e.lastWriteTime),size:o.readableSize(e.length)}));return Promise.resolve(this.listFilter(i)).then(e=>(this.totalCount=i.length,this.displayedCount=e.length,e))}))}exists(e){return this.fs.fileExists({path:this.filePath(e)})}read(e,t){const n=n=>{if(0!==n.errorCode)throw new l(`${e}: `+d(n.errorCode),n.errorCode);const r=n.content,o=(()=>{switch(t){case"Text":case"DataURL":return r;case"ArrayBuffer":return s.dataURItoArrayBuffer(r);case"BinaryString":return s.arrayBufferToString(s.dataURItoArrayBuffer(r))}})();return this.decode(o,e)};switch(t){case"Text":return this.fs.readAllTextCompat({path:this.filePath(e)}).then(n);default:return this.fs.readAllBytesCompat({path:this.filePath(e)}).then(n)}}__write(e,t){return this.ensureDir().then(()=>this.encode(t,e)).then(t=>this.fs.writeAllBytes({content:t,path:this.filePath(e,!0)}).then(t=>{if(!t)throw new Error(`Failed to write to '${e}'`)}))}__overwrite(e,t){return this.remove(e).catch(()=>{}).then(()=>this.write(e,t))}__clear(){return this.list().then(e=>{const t=e.map(e=>this.remove(e.fileName));return Promise.all(t)}).then(()=>{})}__remove(e){return this.ensureDir().then(()=>this.fs.deleteFile({path:this.filePath(e)}).then(()=>{}))}__rename(e,t){return this.ensureDir().then(()=>this.fs.moveFile({sourcePath:this.filePath(e),targetPath:this.filePath(t,!0)}).then(()=>{}))}__copy(e,t){return this.ensureDir().then(()=>this.fs.copyFile({sourcePath:this.filePath(e),targetPath:this.filePath(t,!0)}).then(()=>{}))}filePath(e,t=!1){const n=t?s.sanitizeFileName(e):e,r=a.default.extname(e),o=this.extensions[0],i=r&&r.substr(1).toLowerCase()===o.toLowerCase()?n:n+"."+o;return a.default.join(this.rootDir,this.baseDir,i)}removeExt(e){const t=a.default.basename(e),n=a.default.extname(e),r=t.lastIndexOf(n);return t.substring(0,r)}ensureDir(){const e=this.fs,t=a.default.join(this.rootDir,this.baseDir);return e.directoryExists({path:t}).then(n=>n||e.createDirectory({path:t})).then(()=>{})}}t.NativeFileSystemFlatStorage=u,t.getNativeFileSystemFlatStorage=c.singletonGetterByKey(e=>a.default.join(e.rootDir,e.baseDir),e=>new u(e));class l extends Error{constructor(e,t){super(e),this.name="ErrorWithCode",this.code=t;let n=!0;if("function"==typeof Error.captureStackTrace)try{Error.captureStackTrace(this,this.constructor)}catch(e){n=!1}n||(this.stack=new Error(e).stack)}}function d(e){switch(e){case 0:return"Success";case 1:return"Failed to load";case 2:return"File too large to load";default:return`Unknown error code: ${e}`}}t.ErrorWithCode=l,t.getErrorMessageForCode=d},13:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(81)),i=n(121),a=n(123),s=n(12),c=n(32),u=n(50),l=n(69),d=n(4),h=r(n(27));var f,g,m;!function(e){e.Browser="browser",e.XFile="xfile",e.Nil="nil"}(f=t.StorageStrategyType||(t.StorageStrategyType={})),function(e){e[e.Macro=0]="Macro",e[e.TestSuite=1]="TestSuite",e[e.CSV=2]="CSV",e[e.Screenshot=3]="Screenshot",e[e.Vision=4]="Vision"}(g=t.StorageTarget||(t.StorageTarget={})),function(e){e.StrategyTypeChanged="StrategyTypeChanged",e.RootDirChanged="RootDirChanged",e.ForceReload="ForceReload"}(m=t.StorageManagerEvent||(t.StorageManagerEvent={}));class p extends o.default{constructor(e,t){super(),this.strategyType=f.Nil,this.getMacros=()=>[],this.getMaxMacroCount=e=>Promise.resolve(1/0),this.setCurrentStrategyType(e),t&&t.getMacros&&(this.getMacros=t.getMacros),t&&t.getMaxMacroCount&&(this.getMaxMacroCount=t.getMaxMacroCount),this.getConfig=null==t?void 0:t.getConfig}isXFileMode(){return this.strategyType===f.XFile}isBrowserMode(){return this.strategyType===f.Browser}getCurrentStrategyType(){return this.strategyType}setCurrentStrategyType(e){const t=e!==this.strategyType;return t&&(setTimeout(()=>{this.emit(m.StrategyTypeChanged,e)},0),this.strategyType=e),t}isStrategyTypeAvailable(e){switch(e){case f.Browser:return Promise.resolve(!0);case f.XFile:return c.getXFile().sanityCheck();default:throw new Error(`type '${e}' is not supported`)}}getStorageForTarget(e,t){switch(t||this.strategyType){case f.Browser:switch(e){case g.Macro:{const e=i.getBrowserFileSystemStandardStorage({baseDir:"macros",extensions:["json"],shouldKeepExt:!1,decode:(t,n)=>{const r=u.fromJSONString(t,h.default.basename(n),{withStatus:!0});return Object.assign(Object.assign({},r),{id:e.filePath(n),path:e.relativePath(n)})},encode:(e,t)=>{var n,r;const o=u.toJSONString(Object.assign(Object.assign({},e),{commands:e.data.commands}),{withStatus:!0,ignoreTargetOptions:!!(null===(r=null===(n=this.getConfig)||void 0===n?void 0:n.call(this))||void 0===r?void 0:r.saveAlternativeLocators)});return new Blob([o])}});return window.newMacroStorage=e,e}case g.TestSuite:{const e=i.getBrowserFileSystemStandardStorage({baseDir:"testsuites",extensions:["json"],shouldKeepExt:!1,decode:(t,n)=>{console.log("test suite raw content",n,t,this.getMacros());const r=l.parseTestSuite(t,{fileName:h.default.basename(n)});return Object.assign(Object.assign({},r),{id:e.filePath(n),path:e.relativePath(n)})},encode:(e,t)=>{const n=l.stringifyTestSuite(e);return new Blob([n])}});return window.newTestSuiteStorage=e,e}case g.CSV:return i.getBrowserFileSystemStandardStorage({baseDir:"spreadsheets",extensions:["csv"],shouldKeepExt:!0,transformFileName:e=>e.toLowerCase()});case g.Screenshot:return i.getBrowserFileSystemStandardStorage({baseDir:"screenshots",extensions:["png"],shouldKeepExt:!0,transformFileName:e=>e.toLowerCase()});case g.Vision:return i.getBrowserFileSystemStandardStorage({baseDir:"visions",extensions:["png"],shouldKeepExt:!0,transformFileName:e=>e.toLowerCase()})}case f.XFile:{const{rootDir:t}=c.getXFile().getCachedConfig();switch(e){case g.Macro:{const e=a.getNativeFileSystemStandardStorage({rootDir:t,baseDir:"macros",extensions:["json"],shouldKeepExt:!1,listFilter:e=>this.getMaxMacroCount(this.strategyType).then(t=>s.forestSlice(t,e)),decode:(t,n)=>{const r=u.fromJSONString(t,h.default.basename(n),{withStatus:!0});return Object.assign(Object.assign({},r),{id:e.filePath(n),path:e.relativePath(n)})},encode:(e,t)=>{const n=u.toJSONString(Object.assign(Object.assign({},e),{commands:e.data.commands}),{withStatus:!0});return d.blobToDataURL(new Blob([n]))}});return e}case g.TestSuite:{const e=a.getNativeFileSystemStandardStorage({rootDir:t,baseDir:"testsuites",extensions:["json"],shouldKeepExt:!1,decode:(t,n)=>{const r=l.parseTestSuite(t,{fileName:h.default.basename(n)});return Object.assign(Object.assign({},r),{id:e.filePath(n),path:e.relativePath(n)})},encode:(e,t)=>{const n=l.stringifyTestSuite(e);return d.blobToDataURL(new Blob([n]))}});return e}case g.CSV:return a.getNativeFileSystemStandardStorage({rootDir:t,baseDir:"datasources",extensions:["csv"],shouldKeepExt:!0,allowAbsoluteFilePath:!0,encode:(e,t)=>d.blobToDataURL(new Blob([e]))});case g.Vision:return a.getNativeFileSystemStandardStorage({rootDir:t,baseDir:"images",extensions:["png"],shouldKeepExt:!0,decode:w,encode:(e,t)=>d.blobToDataURL(e)});case g.Screenshot:return a.getNativeFileSystemStandardStorage({rootDir:t,baseDir:"screenshots",extensions:["png"],shouldKeepExt:!0,decode:w,encode:(e,t)=>d.blobToDataURL(e)})}}default:throw new Error(`Unsupported strategy type: '${this.strategyType}'`)}}getMacroStorage(){return this.getStorageForTarget(g.Macro)}getTestSuiteStorage(){return this.getStorageForTarget(g.TestSuite)}getCSVStorage(){return this.getStorageForTarget(g.CSV)}getVisionStorage(){return this.getStorageForTarget(g.Vision)}getScreenshotStorage(){return this.getStorageForTarget(g.Screenshot)}}function w(e,t,n){return"DataURL"!==n||"data:image"===e.substr(0,11)?e:"data:image/png;base64,"+e}t.StorageManager=p,t.getStorageManager=s.singletonGetter((e,t)=>new p(e||f.XFile,t))},146:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(157),i=n(357),a=n(504),s=n(505),c=n(506),u=r(n(159)),l=[new i.ProxyManagerViaListenerAPI,new s.ProxyManagerViaPacAPI,new a.ProxyManagerViaSettingsAPI],d=new c.ProxyHttpAuth({getAuth:(e,t)=>h().getAuth(e,t)});function h(){for(let e=0,t=l.length;e<t;e++)if(l[e].isSupported())return l[e];throw new Error("Unable to use proxy")}t.getProxyManager=h,t.setProxy=function(e){return new Promise((t,n)=>{const r=h();r.isControllable(!1).then(t=>{if(!t)throw new Error(u.default.proxy.notControllable);return d.bind(),e?r.setProxy(e):r.reset()}).then(t,n)})},t.parseProxyUrl=function(e,t){const n=new URL(e),r=new URL(e.replace(/\s*socks[45]/i,"http")),i=r.hostname,a=(()=>{switch(n.protocol){case"http:":return o.ProxyScheme.Http;case"https:":return o.ProxyScheme.Https;case"socks4:":return o.ProxyScheme.Socks4;case"socks5:":return o.ProxyScheme.Socks5;default:throw new Error("Invalid proxy protocol")}})(),s=(()=>{if(r.port)return r.port;switch(a){case o.ProxyScheme.Http:return"80";case o.ProxyScheme.Https:return"443";case o.ProxyScheme.Socks4:case o.ProxyScheme.Socks5:return"1080"}})();if(!i||!i.length)throw new Error("No host found in proxy");if(!s||isNaN(parseInt(s,10)))throw new Error("No valid port found in proxy");const{username:c,password:u}=(()=>{if(!t||!t.length)return{};const e=t.indexOf(",");return-1===e?{username:t}:{username:t.substr(0,e),password:t.substr(e+1)}})();return{type:a,host:i,port:s,username:c,password:u}}},153:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(36)),i=n(12);function a(e){return e.split("::").filter(e=>e.length>0)}t.parseKey=a;t.KeyValueData=class{constructor(){this.withOneLock=i.concurrent(1)(e=>new Promise((t,n)=>{try{Promise.resolve(e()).then(t,n)}catch(e){n(e)}}))}get(e){const[t,n]=this.getMainKeyAndSubKeys(e);return o.default.get(t).then((e={})=>i.getIn(n,e))}set(e,t){return this.withOneLock(()=>{const[n,r]=this.getMainKeyAndSubKeys(e);return o.default.get(n).then((e={})=>{const a=i.safeSetIn(r,t,e);return o.default.set(n,a).then(()=>i.getIn(r,a))})})}update(e,t){return this.withOneLock(()=>{const[n,r]=this.getMainKeyAndSubKeys(e);return o.default.get(n).then((e={})=>{const a=i.safeUpdateIn(r,t,e);return o.default.set(n,a).then(()=>i.getIn(r,a))})})}getMainKeyAndSubKeys(e){const t=a(e);return[t[0],t.slice(1)]}}},157:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Http="http",e.Https="https",e.Socks4="socks4",e.Socks5="socks5"}(t.ProxyScheme||(t.ProxyScheme={})),function(e){e.Direct="direct",e.Http="http",e.Https="https",e.Socks4="socks4",e.Socks5="socks"}(t.FirefoxProxyType||(t.FirefoxProxyType={}))},159:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={proxy:{notControllable:"The proxy settings are controlled by other app(s) or extension(s). Please disable or uninstall the apps or extensions in conflict"},contentHidden:"Content is hidden during replay"}},17:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=e=>e.reduce((e,t)=>(e[t]=t,e),{});t.APP_STATUS=r(["NORMAL","INSPECTOR","RECORDER","PLAYER"]),t.INSPECTOR_STATUS=r(["PENDING","INSPECTING","STOPPED"]),t.RECORDER_STATUS=r(["PENDING","RECORDING","STOPPED"]),t.PLAYER_STATUS=r(["PLAYING","PAUSED","STOPPED"]),t.PLAYER_MODE=r(["TEST_CASE","TEST_SUITE"]),t.CONTENT_SCRIPT_STATUS=r(["NORMAL","RECORDING","INSPECTING","PLAYING"]),t.TEST_CASE_STATUS=r(["NORMAL","SUCCESS","ERROR","ERROR_IN_SUB"]),t.LAST_SCREENSHOT_FILE_NAME="__lastscreenshot",t.LAST_DESKTOP_SCREENSHOT_FILE_NAME="__last_desktop_screenshot",t.UNTITLED_ID="__untitled__"},182:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(184);t.BaseProxyManager=class{constructor(){this.proxy=null,this.registry=r.createListenerRegistry()}getProxy(){return Promise.resolve(this.proxy)}getAuth(e,t){return this.proxy&&this.proxy.username&&this.proxy.host===e&&this.proxy.port===""+t?{username:this.proxy.username,password:this.proxy.password}:null}onChange(e){return this.registry.add("change",e),()=>{this.registry.remove("change",e)}}}},184:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor({process:e,onZero:t,onOne:n}){this.cache={},this.process=e,this.onZero=t||(()=>{}),this.onOne=n||(()=>{})}add(e,t){if(this.cache[e]=this.cache[e]||[],this.cache[e].push(t),1===this.cache[e].length)try{this.onOne(e)}catch(e){console.error("in onOne, "+e.message)}return!0}remove(e,t){if(!this.cache[e])return!1;if(this.cache[e]=this.cache[e].filter(e=>e!==t),0===this.cache[e].length)try{this.onZero(e)}catch(e){console.error("in onZero, "+e.message)}return!0}removeAllWithData(e){Object.keys(this.cache).forEach(t=>{for(let n=this.cache[t].length-1;n>=0;n--)this.cache[t][n]===e&&this.remove(t,this.cache[t][n])})}fire(e,t){return!!this.cache[e]&&(this.cache[e].forEach(n=>{try{this.process(n,t,e)}catch(e){console.error("in process, "+e.message)}}),!0)}has(e){return this.cache[e]&&this.cache[e].length>0}keys(){return Object.keys(this.cache).filter(e=>this.cache[e]&&this.cache[e].length>0)}destroy(){Object.keys(this.cache).forEach(e=>{try{this.onZero(e)}catch(e){console.error("in onZero, "+e.message)}}),this.cache={}}}t.Registry=r,t.createListenerRegistry=function(){return new r({process:(e,t,n)=>{e(t)}})}},185:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.MigrateMacroTestSuiteToBrowserFileSystem="20190401_macro_test_suite_to_browser_fs"}(t.MigrationJobType||(t.MigrationJobType={})),function(e){e[e.AlreadyMigrated=0]="AlreadyMigrated",e[e.NotQualified=1]="NotQualified",e[e.Success=2]="Success",e[e.Error=3]="Error",e[e.JobUnknown=4]="JobUnknown"}(t.MigrationResult||(t.MigrationResult={}))},20:function(e,t,n){"use strict";n.r(t);var r=n(93),o=function(){throw new Error("You are not a top window, not allowed to initialize/use csIpc")},i=window.top===window?Object(r.csInit)():{ask:o,send:o,onAsk:o,destroy:o};t.default=i},22:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(4);function o(e){return new Promise((t,n)=>{const r=new Image;r.onload=()=>{t({$img:r,width:r.width,height:r.height})},r.onerror=e=>{n(e)},r.src=e})}function i(e){return"data:image/svg+xml;base64,"+window.btoa(e)}function a(e){return new Promise((t,n)=>{const r=document.createElement("canvas"),o=r.getContext("2d"),a=document.createElement("img"),s=i(e),c=e.match(/<svg[\s\S]*?width="(.*?)"/m),u=e.match(/<svg[\s\S]*?height="(.*?)"/m),l=parseInt(c[1],10),d=parseInt(u[1],10);a.src=s,a.onload=function(){r.width=l,r.height=d,o.drawImage(a,0,0,l,d),t(r)},a.onerror=function(e){n(e)}})}function s(e,t,n){if(e>255||t>255||n>255)throw"Invalid color component";return(e<<16|t<<8|n).toString(16)}t.getStyle=function(e){if(!e)throw new Error("getStyle: dom does not exist");return getComputedStyle(e)},t.setStyle=function(e,t){if(!e)throw new Error("setStyle: dom does not exist");for(var n=0,r=Object.keys(t),o=r.length;n<o;n++)e.style[r[n]]=t[r[n]];return e},t.pixel=function(e){return-1!==(e+"").indexOf("px")?e:(e||0)+"px"},t.bindDrag=e=>{const{onDragStart:t,onDragEnd:n,onDrag:r,$el:o,preventGlobalClick:i=!0,doc:a=document}=e;let s=!1,c={x:0,y:0};const u=e=>{s=!0,c={x:e.screenX,y:e.screenY},t(e)},l=e=>{if(!s)return;s=!1;const t=e.screenX-c.x,r=e.screenY-c.y;n(e,{dx:t,dy:r})},d=e=>{if(!s)return;const t=e.screenX-c.x,n=e.screenY-c.y;r(e,{dx:t,dy:n}),e.preventDefault(),e.stopPropagation()},h=e=>{e.preventDefault(),e.stopPropagation()};return i&&a.addEventListener("click",h,!0),a.addEventListener("mousemove",d,!0),a.addEventListener("mouseup",l,!0),o.addEventListener("mousedown",u,!0),()=>{a.removeEventListener("click",h,!0),a.removeEventListener("mousemove",d,!0),a.removeEventListener("mouseup",l,!0),o.removeEventListener("mousedown",u,!0)}},t.bindContentEditableChange=e=>{const{onChange:t,doc:n=document}=e;let r=null,o=null;const i=e=>{e.target&&"true"===e.target.contentEditable&&(r=e.target,o=r.innerHTML)},a=e=>{e.target!==r||r&&r.innerHTML!==o&&t(e),r=null,o=null};return n.addEventListener("focus",i,!0),n.addEventListener("blur",a,!0),()=>{n.removeEventListener("focus",i,!0),n.removeEventListener("blur",a,!0)}},t.scrollLeft=function(e){return e.documentElement.scrollLeft},t.scrollTop=function(e){return e.documentElement.scrollTop},t.domText=e=>{const t=e.innerText?e.innerText.trim():"",n=e.textContent,r=n.toUpperCase().indexOf(t.toUpperCase());return-1===r?t:n.substr(r,t.length)},t.isVisible=function(e){if(e===window.document)return!0;if(!e)return!0;const n=window.getComputedStyle(e);return"none"!==n.display&&"0"!==n.opacity&&"hidden"!==n.visibility&&t.isVisible(e.parentNode)},t.cssSelector=function(e){if(!e)return"";if(1!==e.nodeType)return"";if("BODY"===e.tagName)return"body";if(e.id)return"#"+e.id;var n=e.className.split(/\s+/g).filter((function(e){return e&&e.length})),o=Array.from(e.parentNode?e.parentNode.childNodes:[]).filter((function(e){return 1===e.nodeType})),i=o.filter((function(t){return t.tagName===e.tagName})),a=o.filter((function(e){var t=e.className.split(/\s+/g);return r.and(...n.map((function(e){return-1!==t.indexOf(e)})))})),s="";s=1===i.length?"":n.length&&1===a.length?"."+n.join("."):":nth-child("+(1+o.findIndex((function(t){return t===e})))+")";var c=e.tagName.toLowerCase()+s;return t.cssSelector(e.parentNode)+" > "+c},t.isPositionFixed=e=>!(!e||e===document.documentElement||e===document.body)&&("fixed"===getComputedStyle(e).position||t.isPositionFixed(e.parentNode)),t.offset=function(e){if(!e)return{left:0,top:0};var t=e.getBoundingClientRect();return{left:t.left+window.scrollX,top:t.top+window.scrollY}},t.accurateOffset=function e(t){if(!t)return{left:0,top:0};const n=t.ownerDocument;if(!n||t===n.documentElement)return{left:0,top:0};const r=e(t.offsetParent);return{left:r.left+t.offsetLeft,top:r.top+t.offsetTop}},t.preloadImage=o,t.isFirefox=function(){return/Firefox/.test(window.navigator.userAgent)},t.svgNodetoString=function(e){return e.outerHTML},t.svgToBase64=i,t.canvasFromSVG=a,t.imageBlobFromSVG=function(e,t="image/png",n){return a(e).then(e=>new Promise((r,o)=>{try{e.toBlob(r,t,n)}catch(e){o(e)}}))},t.imageDataFromUrl=function(e){return o(e).then(({$img:e,width:t,height:n})=>{const r=document.createElement("canvas");r.width=t,r.height=n;const o=r.getContext("2d");return o.drawImage(e,0,0,t,n),o.getImageData(0,0,t,n)})},t.subImage=function(e,t){return new Promise((n,r)=>{const o=new Image;o.onload=()=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(o,0,0,o.width,o.height,-1*t.x,-1*t.y,o.width,o.height),n(e.toDataURL())},o.src=e})},t.rgbToHex=s,t.getPixel=function(e){const{x:t,y:n,dataUrl:r}=e;return new Promise((e,o)=>{const i=new Image;i.onload=()=>{const r=i.width,a=i.height;if(t<0||n<0||t>r||n>a)return o(new Error(`${t}, ${n} is out of screenshot bound 0, 0 ~ ${r}, ${a}`));const c=document.createElement("canvas");c.width=t+5,c.height=n+5;const u=c.getContext("2d");let l;u.drawImage(i,0,0,t+5,n+5,0,0,t+5,n+5);try{const r=u.getImageData(t,n,1,1).data;l="#"+("000000"+s(r[0],r[1],r[2])).slice(-6),e(l)}catch(e){o(new Error("Failed to get pixel color"+((null==e?void 0:e.message)?`: ${e.message}.`:".")))}},i.src=r})},t.scaleRect=function(e,t){return{x:t*e.x,y:t*e.y,width:t*e.width,height:t*e.height}},t.isEditable=function(e){if("true"===e.contentEditable)return!0;const t=(e.tagName||"").toLowerCase();if(-1===["input","textarea"].indexOf(t))return!1;const n=e.disabled,r=e.readOnly;return!n&&!r},t.hasAncestor=function(e,t){let n=e;for(;n;){if(t(n))return!0;n=n.parentNode}return!1},t.getAncestor=function(e,t){let n=e;for(;n;){if(t(n))return n;n=n.parentNode}return null}},27:function(e,t,n){"use strict";n.r(t);var r=n(55);n.d(t,"win32",(function(){return r.win32})),n.d(t,"posix",(function(){return r.posix}));var o=/windows/i.test(window.navigator.userAgent)?r.win32:r.posix;t.default=o},32:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(90),i=n(60),a=n(12),s=r(n(27));class c extends o.XModule{getName(){return o.XModuleTypes.XFile}getAPI(){return i.getNativeFileSystemAPI()}initConfig(){return this.getConfig().then(e=>{if(!e.rootDir){const e=i.getNativeFileSystemAPI();return e.getSpecialFolderPath({folder:i.SpecialFolder.UserDesktop}).then(t=>{const n=s.default.join(t,"uivision");return e.ensureDir({path:n}).then(e=>{this.setConfig({rootDir:e?n:t})})}).catch(e=>{if(!/Specified native messaging host not found/.test(e))throw e})}})}sanityCheck(e){return Promise.all([this.getConfig(),this.getAPI().getVersion().then(()=>this.getAPI(),()=>this.getAPI().reconnect()).catch(e=>{throw new Error("xFile is not installed yet")})]).then(([t,n])=>{if(e)return!0;if(!t.rootDir)throw new Error("rootDir is not set");return n.directoryExists({path:t.rootDir}).then(e=>{if(!e)throw new Error(`Directory '${t.rootDir}' doesn't exist`);return!0}).then(()=>{const e=s.default.join(t.rootDir,"__kantu__"+Math.round(100*Math.random()));return n.createDirectory({path:e}).then(t=>{if(!t)throw new Error;return n.removeDirectory({path:e})}).then(e=>{if(!e)throw new Error;return!0}).catch(e=>{throw new Error(`Directory '${t.rootDir}' is not writable`)})})})}checkUpdate(){return Promise.reject(new Error("checkUpdate is not implemented yet"))}checkUpdateLink(e,t){return`https://ui.vision/x/idehelp?help=xfileaccess_updatecheck&xversion=${e}&kantuversion=${t}`}downloadLink(){return"https://ui.vision/x/idehelp?help=xfileaccess_download"}infoLink(){return"https://ui.vision/x/idehelp?help=xfileaccess"}}t.XFile=c,t.getXFile=a.singletonGetter(()=>new c)},324:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(60),i=n(32),a=r(n(27)),s=r(n(11)),c=n(12),u=n(13);class l{constructor(e={}){this.pDirReady=Promise.resolve(!1),this.logsDir="",this.fileName="log.txt",this.waitForStorageManager=()=>Promise.resolve(u.getStorageManager()),this.check(),this.updateLogFileName(),e.waitForStorageManager&&(this.waitForStorageManager=e.waitForStorageManager)}updateLogFileName(){const e=new Date,t=`${e.getFullYear()}${c.pad2digits(e.getMonth()+1)}${c.pad2digits(e.getDate())}`,n=[e.getHours(),e.getMinutes(),e.getSeconds()].map(e=>c.pad2digits(e)).join("");this.fileName=`log-${t}-${n}.txt`}check(){return this.pDirReady=i.getXFile().sanityCheck(!0).then(e=>{if(!e)return!1;const{rootDir:t}=i.getXFile().getCachedConfig();return!!t&&(this.logsDir=a.default.join(t,"logs"),o.getNativeFileSystemAPI().ensureDir({path:this.logsDir}))}),this.pDirReady}log(e){return this.waitForStorageManager().then(t=>!!t.isXFileMode()&&i.getXFile().sanityCheck(!0).then(()=>this.pDirReady).then(t=>!!t&&o.getNativeFileSystemAPI().appendAllText({path:a.default.join(this.logsDir,this.fileName),content:d(e)}),e=>(s.default.warn("Failed to log: ",e.message),!1)))}logWithTime(e){return this.log(`${(new Date).toISOString()} - ${e}`)}logTo(e,t){return this.waitForStorageManager().then(n=>!!n.isXFileMode()&&i.getXFile().sanityCheck(!0).then(n=>{if(!n)return!1;const r=a.default.dirname(e);return o.getNativeFileSystemAPI().ensureDir({path:r}).then(n=>!!n&&o.getNativeFileSystemAPI().appendAllText({path:e,content:d(t)}))},e=>(s.default.warn("Failed to log: ",e.message),!1)))}}function d(e){return 0===e.length?e:"\n"!==e.charAt(e.length-1)?e+"\n":e}t.LogService=l,t.getLogService=c.singletonGetter(()=>new l)},325:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(185),i=n(511),a=n(13),s=n(105),c=r(n(107)),u=n(358),l=n(12);class d{constructor(){this.oldMacros=[]}getMeta(){return{createdAt:new Date("2019-04-01").getTime(),goal:["Migrate macros and test suites from indexedDB storage to Browser File System storage","In order to prepare for an easy support for deep folder structure","Note: the old indexedDB storage WILL NOT be cleared, just in case any user loses his data during migration","The real clean up could be done in future releases, in the form of another migration job"].join(". ")}}getType(){return o.MigrationJobType.MigrateMacroTestSuiteToBrowserFileSystem}previousVersionRange(){return"<=4.0.1"}shouldMigrate(){const e=this.getOldMacroStorage(),t=this.getOldTestSuiteStorage();return Promise.all([e.list().then(e=>e.length),t.list().then(e=>e.length)]).then(([e,t])=>e>0||t>0)}migrate(){const e=()=>this.getOldTestSuiteStorage().readAll().then(e=>(console.log("this.getOldTestSuiteStorage().readAll()",e),c.default.ensureDirectory("/testsuites").then(()=>this.getNewTestSuiteStorage().bulkWrite(e)))).then(()=>!0),t=()=>s.getMacroExtraKeyValueData().getAll().then(e=>(this.oldMacros.forEach(t=>{const n=this.getNewMacroStorage().filePath(t.name),r=t.id;e[r]&&(e[n]=e[r])}),s.getMacroExtraKeyValueData().set("",e)));return(()=>this.getOldMacroStorage().readAll().then(e=>(console.log("this.getOldMacroStorage().readAll()",e),this.oldMacros=e.map(e=>e.content),c.default.ensureDirectory("/macros").then(()=>this.getNewMacroStorage().bulkWrite(e)))).then(()=>!0))().then(()=>e()).then(()=>t()).then(()=>!0)}remedy(){const e=()=>this.getOldTestSuiteStorage().readAll().then(e=>e.map(e=>e.content));return(()=>this.getOldMacroStorage().readAll().then(e=>(this.oldMacros=e.map(e=>e.content),this.oldMacros)))().then(t=>e().then(e=>u.backup({backup:{testCase:!0,testSuite:!0},macroNodes:t,testSuites:e})))}getOldMacroStorage(){return i.getIndexeddbFlatStorage({table:"testCases"})}getOldTestSuiteStorage(){return i.getIndexeddbFlatStorage({table:"testSuites"})}getNewMacroStorage(){return this.getStorageManager().getStorageForTarget(a.StorageTarget.Macro,a.StorageStrategyType.Browser)}getNewTestSuiteStorage(){return this.getStorageManager().getStorageForTarget(a.StorageTarget.TestSuite,a.StorageStrategyType.Browser)}getStorageManager(){return new a.StorageManager(a.StorageStrategyType.Browser,{getMacros:()=>this.oldMacros,getMaxMacroCount:()=>Promise.resolve(1/0)})}}t.MigrateMacroTestSuiteToBrowserFileSystem=d,t.getMigrateMacroTestSuiteToBrowserFileSystem=l.singletonGetter(()=>new d)},34:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});r(n(10)).default.isFirefox();t.default={preinstall:{version:"5.8.8",macroFolder:"/Demo"},urlAfterUpgrade:"https://ui.vision/x/idehelp?help=k_update",urlAfterInstall:"https://ui.vision/x/idehelp?help=k_welcome",urlAfterUninstall:"https://ui.vision/x/idehelp?help=k_why",performanceLimit:{fileCount:1/0},xmodulesLimit:{unregistered:{ocrCommandCount:100,xCommandCount:25,xFileMacroCount:10,proxyExecCount:5,upgradeUrl:"https://ui.vision/x/idehelp?help=k_xupgrade"},free:{ocrCommandCount:250,xCommandCount:1/0,xFileMacroCount:20,proxyExecCount:10,upgradeUrl:"https://ui.vision/x/idehelp?help=k_xupgradepro"},pro:{ocrCommandCount:500,xCommandCount:1/0,xFileMacroCount:1/0,proxyExecCount:1/0,upgradeUrl:"https://ui.vision/x/idehelp?help=k_xupgrade_contactsupport"}},xfile:{minVersionToReadBigFile:"1.0.10"},ocr:{apiList:[{id:"1",key:"kantu_only_53b8",url:"https://apipro1.ocr.space/parse/image"},{id:"2",key:"kantu_only_53b8",url:"https://apipro2.ocr.space/parse/image"},{id:"3",key:"kantu_only_53b8",url:"https://apipro3.ocr.space/parse/image"}],apiTimeout:6e4,singleApiTimeout:3e4,apiHealthyResponseTime:2e4,resetTime:864e5},license:{api:{url:"https://license1.ocr.space/api/status"}},icons:{normal:"logo38.png",inverted:"inverted_logo_38.png"},forceMigrationRemedy:!1,iframePostMessageTimeout:500,ui:{commandItemHeight:35},commandRunner:{sendKeysMaxCharCount:1e3}}},344:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MethodTypeInvocationNames=["get_version","get_desktop_dpi","get_image_info","capture_desktop","search_image","search_desktop","get_max_file_range","get_file_size","read_file_range"]},345:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(97);class o extends r.NativeMessagingHost{constructor(){super(o.HOST_NAME)}}t.KantuCVHost=o,o.HOST_NAME="com.a9t9.kantu.cv"},346:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){const t=new Uint8Array([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47]),n=new Uint8Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);function r(e,t,r){if(r>4)throw new Error("maxLength should be in range [0, 4].");const o=new Uint8Array(4);for(let i=0;i<r;++i){const r=e.charCodeAt(t+i),a=n[r];if(255===a)return;o[i]=a}return(o[0]<<18)+(o[1]<<12)+(o[2]<<6)+(o[3]<<0)}function o(e,t,n){e[t+0]=n>>16&255,e[t+1]=n>>8&255,e[t+2]=255&n}e.encode=function(e){const n=e.length,r=function(e){let t=e/3*4;return t+=e%3!=0?4:0,t}(n),o=n%3,i=n-o,a=new Uint8Array(r);let s,c=0;for(s=0;s<i;s+=3)a[c+0]=t[(252&e[s])>>2],a[c+1]=t[(3&e[s])<<4|(240&e[s+1])>>4],a[c+2]=t[(15&e[s+1])<<2|(192&e[s+2])>>6],a[c+3]=t[63&e[s+2]],c+=4;switch(s=i,o){case 2:a[c+0]=t[(252&e[s])>>2],a[c+1]=t[(3&e[s])<<4|(240&e[s+1])>>4],a[c+2]=t[(15&e[s+1])<<2],a[c+3]=61,c+=4;break;case 1:a[c+0]=t[(252&e[s])>>2],a[c+1]=t[(3&e[s])<<4],a[c+2]=61,a[c+3]=61,c+=4}return new TextDecoder("ascii").decode(a)},e.decode=function(e){const t=e.length;if(t%4!=0)return;let n=0;t>0&&61==e.charCodeAt(t-1)&&(++n,t>1&&61==e.charCodeAt(t-2)&&++n);const i=-4&t-n,a=new Uint8Array(6*t/8-n);let s,c=0,u=0;for(;c<i;){if(s=r(e,c,4),void 0===s)return;o(a,u,s),c+=4,u+=3}if(n>0){if(s=r(e,c,4-n),void 0===s)return;switch(n){case 1:a[u+0]=s>>16&255,a[u+1]=s>>8&255;break;case 2:a[u+0]=s>>16&255}}return a}}(t.base64||(t.base64={}))},357:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(157),o=n(182);function i(e){return Object.assign(Object.assign({},e),{type:e.type===r.ProxyScheme.Socks5?r.FirefoxProxyType.Socks5:e.type})}t.convertToFirefoxProxyInfo=i;class a extends o.BaseProxyManager{constructor(){super(),this.unbind=()=>{},this.isBound=!1}isSupported(){return"undefined"!=typeof browser&&browser.proxy&&browser.proxy.onRequest}isControllable(e){return Promise.resolve(!0)}setProxy(e){return this.bind(),this.proxy=e,this.notifyProxyChange(),Promise.resolve()}reset(){return this.proxy=null,this.notifyProxyChange(),Promise.resolve()}notifyProxyChange(){setTimeout(()=>{this.registry.fire("change",this.proxy)},10)}bind(){if(this.isBound)return;this.isBound=!0;const e=this.onProxyRequest.bind(this);browser.proxy.onRequest.addListener(e,{urls:["<all_urls>"]}),this.unbind=()=>browser.proxy.onRequest.removeListener(e)}onProxyRequest(e){return this.proxy?i(this.proxy):{type:r.FirefoxProxyType.Direct}}}t.ProxyManagerViaListenerAPI=a},358:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(70)),i=r(n(142)),a=n(4),s=n(50),c=n(69),u=n(13),l=n(27),d=n(374);t.backup=function(e){const{backup:t,macroNodes:n,testSuites:r,screenshots:h,csvs:f,visions:g}=e,m=new i.default,p=[];if(t.testCase&&n&&n.length){const t=m.folder(d.ZipFolders.Macros);n.forEach(n=>{const r=l.posix.dirname(n.relativePath),o=l.posix.basename(n.relativePath),i=((e,t)=>{if("."===e)return t;return e.split(l.posix.sep).reduce((e,t)=>e.folder(t),t)})(r,t);p.push(u.getStorageManager().getMacroStorage().read(n.fullPath,"Text").then(t=>{const n=t;i.file(o,s.toJSONString({name:n.name,commands:n.data.commands},{ignoreTargetOptions:!!e.ignoreMacroTargetOptions}))}))})}if(t.testSuite&&r&&r.length){const e=m.folder(d.ZipFolders.TestSuites),t=a.nameFactory();r.forEach(n=>{const r=t(n.name);e.file(`${r}.json`,c.stringifyTestSuite(n))})}if(t.screenshot&&h&&h.length){const e=m.folder(d.ZipFolders.Screenshots),t=u.getStorageManager().getScreenshotStorage();h.forEach(n=>{p.push(t.read(n.fullPath,"ArrayBuffer").then(t=>{e.file(n.name,t,{binary:!0})}))})}if(t.vision&&g&&g.length){const e=m.folder(d.ZipFolders.Visions),t=u.getStorageManager().getVisionStorage();g.forEach(n=>{p.push(t.read(n.fullPath,"ArrayBuffer").then(t=>{e.file(n.name,t,{binary:!0})}))})}if(t.csv&&f&&f.length){const e=m.folder(d.ZipFolders.Csvs),t=u.getStorageManager().getCSVStorage();f.forEach(n=>{p.push(t.read(n.fullPath,"Text").then(t=>e.file(n.name,t)))})}return Promise.all(p).then(()=>{m.generateAsync({type:"blob"}).then((function(e){o.default.saveAs(e,"uivision_backup.zip")}))})}},359:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(12);var o;!function(e){e.GetVersion="getVersion",e.GetDPI="getDPI",e.SetDirectory="setDirectory",e.SaveScreenshot="saveScreenshot"}(o||(o={}));class i{reconnect(){return Promise.resolve(this)}getVersion(){return this.sendMessage(o.GetVersion)}getDpi(){return this.sendMessage(o.GetDPI)}captureDesktop(){return this.sendMessage(o.SaveScreenshot)}changeDirectory(e){return this.sendMessage(o.SaveScreenshot,{current:e})}sendMessage(e,t={}){return new Promise((n,r)=>{chrome.runtime.sendNativeMessage(i.HostName,Object.assign(Object.assign({},t),{command:e}),t=>{if(t&&t.result)n(t[i.FieldNameMapping[e]]);else{let e=t&&t.error;e=e||"Unknown error",r(new Error(e))}})})}}t.NativeScreenCapture=i,i.HostName="com.github.teamdocs.kcmd",i.FieldNameMapping={[o.GetVersion]:"version",[o.GetDPI]:"dpi",[o.SetDirectory]:"directory",[o.SaveScreenshot]:"file"},t.getNativeScreenCapture=r.singletonGetter(()=>new i)},36:function(e,t,n){"use strict";n.r(t);var r=n(10),o=n.n(r),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};var a=o.a.storage.local,s={get:function(e){return a.get(e).then((function(t){return t[e]}))},set:function(e,t){return a.set(function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},e,t)).then((function(){return!0}))},remove:function(e){return a.remove(e).then((function(){return!0}))},clear:function(){return a.clear().then((function(){return!0}))},addListener:function(e){o.a.storage.onChanged.addListener((function(t,n){var r=Object.keys(t).map((function(e){return i({},t[e],{key:e})}));e(r)}))}};t.default=s},361:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(512),o=n(513),i=n(325),a=n(12);class s extends r.MigrationService{constructor(){super({storage:{get:e=>o.getMigrationKeyValueData().get(e),set:(e,t)=>o.getMigrationKeyValueData().set(e,t).then(()=>!0),getAll:()=>o.getMigrationKeyValueData().getAll().then(e=>Object.keys(e).map(t=>e[t]))},jobs:[i.getMigrateMacroTestSuiteToBrowserFileSystem()]})}}t.KantuMigrationService=s,t.getKantuMigrationService=a.singletonGetter(()=>new s)},366:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(12),i=r(n(10));class a{createMenus(e){return o.flow(...e.map(e=>()=>i.default.contextMenus.create(e))).then(()=>{})}destroyMenus(){return i.default.contextMenus.removeAll()}}t.ContextMenuService=a,t.getContextMenuService=o.singletonGetter(()=>new a)},374:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Macros="macros",e.TestSuites="testsuites",e.Screenshots="screenshots",e.Csvs="datasources",e.Visions="images"}(t.ZipFolders||(t.ZipFolders={}))},393:function(e,t,n){"use strict";n.r(t),n.d(t,"resizeWindow",(function(){return u})),n.d(t,"resizeViewport",(function(){return l})),n.d(t,"resizeViewportOfTab",(function(){return d})),n.d(t,"getWindowSize",(function(){return h})),n.d(t,"getFocusedWindowSize",(function(){return f}));var r=n(10),o=n.n(r),i=n(4),a=n(11),s=n.n(a),c=function(e,t,n,r,o){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=i||n<e-n-r;if(s()("calcOffset",e,n,r,o,i),a)return n;if(!a){return r+n-o}};function u(e,t){var n=screen.availWidth,r=screen.availHeight,i=screen.availLeft,a=screen.availTop;return o.a.windows.get(e).then((function(s){var u=s.left,l=s.top,d=s.width,h=s.height;return o.a.windows.update(e,t).then((function(s){var f=c(n,i,u,d,s.width),g=c(r,a,l,h,s.height,!0);o.a.windows.update(e,{left:f,top:g});var m={width:s.width,height:s.height};return{actual:m,desired:t,diff:["width","height"].filter((function(e){return m[e]!==t[e]}))}}))}))}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=2;return s()("resizeViewport, ROUND",n),h(e).then((function(o){g(o);var a=o.window.width-o.viewport.width,c=o.window.height-o.viewport.height,d={width:a+t.width,height:c+t.height};return s()("size set to",d),u(e,d).then((function(){return h(e)})).then((function(o){g(o);var a={actual:o.viewport,desired:t,diff:["width","height"].filter((function(e){return o.viewport[e]!==t[e]}))};return 0===a.diff.length||n>=r?a:Object(i.delay)((function(){}),0).then((function(){return l(e,t,n+1)}))}))}))}function d(e,t){return o.a.tabs.get(e).then((function(e){return l(e.windowId,t)}))}function h(e){return o.a.windows.get(e,{populate:!0}).then((function(e){var t=e.tabs.find((function(e){return e.active}));return{window:{width:e.width,height:e.height,left:e.left,top:e.top},viewport:{width:t.width,height:t.height}}}))}function f(){return o.a.windows.getLastFocused().then((function(e){return h(e.id)}))}function g(e){s()(e.window,e.viewport),s()("dx = ",e.window.width-e.viewport.width),s()("dy = ",e.window.height-e.viewport.height)}},411:function(e,t,n){"use strict";var r=function(){var e,t,n=document.createElement("div");return n.setAttribute("contenteditable",!0),n.id="clipboard_textarea",e=n,t={position:"aboslute",top:"-9999px",left:"-9999px"},Object.keys(t).forEach((function(n){e.style[n]=t[n]})),(document.body||document.documentElement).appendChild(n),n},o=function(e){var t=document.getElementById("clipboard_textarea")||r(),n=void 0;try{n=e(t)}catch(e){console.error(e)}finally{t.innerHTML=""}return n},i={set:function(e){o((function(t){t.innerText=e,t.focus(),document.execCommand("selectAll",!1,null),document.execCommand("copy")}))},get:function(){return o((function(e){return e.blur(),e.focus(),document.execCommand("paste")?e.innerText:"no luck"}))}};t.a=i},412:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(10)),i=n(65),a=n(1084),s=o.default.extension.getURL("desktop_screenshot_editor.html");t.openDesktopScreenshotWindow=(()=>{let e=0;return()=>o.default.tabs.get(e).catch(e=>null).then(t=>{const n=a.openPageInTab({url:s,tabId:t&&t.id,keep:!0,popup:!0,domReady:!0,focus:!0,width:screen.availWidth/2+50,height:screen.availHeight/2+100,left:screen.availWidth/4-25,top:screen.availHeight/4-50});return n.getTabId().then(t=>(e=t,i.activateTab(t))),n})})(),t.runInDesktopScreenshotEditor=function(e){return t.openDesktopScreenshotWindow().then(t=>t.ask(e.type,e.data))}},42:function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Browser="browser",e.Desktop="desktop",e.DesktopScreenCapture="desktop_screen_capture"}(r=t.ComputerVisionType||(t.ComputerVisionType={})),t.isCVTypeForDesktop=function(e){return e===r.Desktop||e===r.DesktopScreenCapture}},43:function(e,t,n){"use strict";function r(e){switch(e){case"echo":case"open":case"pause":case"waitForPageToLoad":case"assertAlert":case"assertConfirmation":case"assertPrompt":case"answerOnNextPrompt":case"store":case"storeTitle":case"assertTitle":case"verifyTitle":case"selectWindow":case"captureScreenshot":case"captureDesktopScreenshot":case"refresh":case"deleteAllCookies":case"label":case"gotoLabel":case"csvRead":case"csvReadArray":case"csvSave":case"csvSaveArray":case"captureEntirePageScreenshot":case"onDownload":case"throwError":case"comment":case"onError":case"sourceSearch":case"sourceExtract":case"localStorageExport":case"visionLimitSearchArea":case"visionLimitSearchAreaRelative":case"visualGetPixelColor":case"bringBrowserToForeground":case"bringIDEandBrowserToBackground":case"setWindowSize":case"prompt":case"XRun":case"XRunAndWait":case"XDesktopAutomation":case"setProxy":case"run":case"executeScript":case"executeScript_Sandbox":case"do":case"repeatIf":case"else":case"elseif":case"end":case"if_v2":case"while_v2":case"gotoIf_v2":case"times":case"forEach":return!1;default:return!0}}Object.defineProperty(t,"__esModule",{value:!0}),t.availableCommands=(()=>{const e=["open","click","clickAndWait","select","selectAndWait","addSelection","removeSelection","type","pause","waitForPageToLoad","selectFrame","assertAlert","assertConfirmation","assertPrompt","answerOnNextPrompt","store","storeText","storeTitle","storeAttribute","storeXpathCount","assertText","assertTitle","clickAt","echo","mouseOver","verifyText","verifyTitle","sendKeys","dragAndDropToObject","selectWindow","captureScreenshot","captureDesktopScreenshot","refresh","assert","assertElementPresent","assertElementNotPresent","assertEditable","assertNotEditable","verify","verifyElementPresent","verifyElementNotPresent","verifyEditable","verifyNotEditable","deleteAllCookies","label","gotoLabel","csvRead","csvReadArray","csvSave","csvSaveArray","storeValue","assertValue","verifyValue","storeChecked","captureEntirePageScreenshot","onDownload","throwError","comment","waitForElementVisible","waitForElementNotVisible","waitForElementPresent","waitForElementNotPresent","onError","sourceSearch","sourceExtract","storeImage","localStorageExport","visionLimitSearchArea","visionLimitSearchAreaRelative","visualSearch","visualVerify","visualAssert","visualGetPixelColor","editContent","bringBrowserToForeground","bringIDEandBrowserToBackground","setWindowSize","prompt","XRun","XRunAndWait","XClick","XClickRelative","XType","XMove","XMoveRelative","XMouseWheel","XDesktopAutomation","OCRSearch","OCRExtract","OCRExtractRelative","setProxy","run","executeScript","executeScript_Sandbox","check","uncheck","assertChecked","assertNotChecked","verifyChecked","verifyNotChecked","do","repeatIf","else","elseif","end","if_v2","while_v2","gotoIf_v2","times","forEach","break","continue"];return e.sort((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1),e})(),t.normalizeCommandName=function(e){if(!e)return"";const n=e.toLowerCase(),r=t.availableCommands.map(e=>e.toLowerCase()).findIndex(e=>e===n);return-1===r?e:t.availableCommands[r]},t.commandText=function(e){switch(e){case"if":case"while":case"gotoIf":return e+"_v1_deprecated";case"storeEval":case"endif":case"endwhile":case"resize":return e+"_deprecated";default:return e}},t.isValidCmd=function(e){return-1!==t.availableCommands.indexOf(e)},t.isExtensionResourceOnlyCommand=function(e){switch(e){case"if":case"while":case"gotoIf":case"if_v2":case"while_v2":case"gotoIf_v2":case"executeScript_Sandbox":case"run":case"store":case"echo":case"prompt":case"throwError":case"pause":case"localStorageExport":return!0;default:return!1}},t.canCommandReadImage=function(e){switch(e){case"visualSearch":case"visualVerify":case"visualAssert":case"XClick":case"XClickRelative":case"XMove":case"XMoveRelative":case"OCRExtract":case"OCRExtractRelative":return!0;default:return!1}},t.canCommandReadCsv=function(e){switch(e){case"csvRead":case"csvReadArray":return!0;default:return!1}},t.canCommandRunMacro=function(e){switch(e){case"run":return!0;default:return!1}},t.doesCommandSupportTargetOptions=function(e){switch(e){case"click":case"clickAndWait":case"select":case"selectAndWait":case"type":case"mouseOver":case"verifyText":case"sendKeys":case"dragAndDropToObject":case"assertElementPresent":case"assertEditable":case"assertNotEditable":case"verifyElementPresent":case"verifyEditable":case"verifyNotEditable":case"storeValue":case"assertValue":case"verifyValue":case"storeChecked":case"waitForElementVisible":case"waitForElementPresent":case"XClick":case"XClickRelative":case"XMove":case"XMoveRelative":case"check":case"uncheck":case"assertChecked":case"assertNotChecked":case"verifyChecked":case"verifyNotChecked":return!0;default:return!1}},t.canCommandFind=r,t.canCommandSelect=function(e){const t=r(e);if(t)return t;switch(e){case"visualGetPixelColor":return!0;default:return!1}},t.indentCreatedByCommand=function(e){switch(e){case"if":case"if_v2":case"while":case"while_v2":case"do":case"times":case"forEach":return{selfIndent:0,nextIndent:1};case"else":case"elseif":return{selfIndent:-1,nextIndent:1};case"end":case"endif":case"endwhile":case"repeatIf":return{selfIndent:-1,nextIndent:0};default:return{selfIndent:0,nextIndent:0}}},t.parseImageTarget=function(e){if(!e||!e.length)return null;const t=e.match(/^([^@#]+?\.png)(?:@([\d.]+))?(?:#(\d+))?(?:\[([^\]]+)\])?$/);return t?{fileName:t[1],confidence:t[2]?parseFloat(t[2]):void 0,index:t[3]?parseInt(t[3])-1:void 0,imageUrl:t[4]}:null}},50:function(e,t,n){"use strict";n.r(t),n.d(t,"toHtml",(function(){return f})),n.d(t,"generateEmptyHtml",(function(){return g})),n.d(t,"toHtmlDataUri",(function(){return m})),n.d(t,"fromHtml",(function(){return p})),n.d(t,"fromJSONString",(function(){return w})),n.d(t,"toJSONString",(function(){return y})),n.d(t,"toJSONDataUri",(function(){return v})),n.d(t,"toBookmarkData",(function(){return b})),n.d(t,"generateMacroEntryHtml",(function(){return S}));n(108);var r=n(66),o=n.n(r),i=n(83),a=n.n(i),s=n(104),c=n.n(s),u=n(43),l=n(13),d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function h(e){var t=e.name,n=e.baseUrl,r=e.commandTrs,o=e.noImport;return'<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">\n<head profile="http://selenium-ide.openqa.org/profiles/test-case">\n<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />\n'+(o?"":'<link rel="selenium.base" href="'+n+'" />')+"\n<title>"+t+"</title>\n</head>\n<body>\n"+(o?"<h3>Starting Browser and UI.Vision...</h3>":'\n    <table cellpadding="1" cellspacing="1" border="1">\n    <thead>\n    <tr><td rowspan="1" colspan="3">'+t+"</td></tr>\n    </thead><tbody>\n    "+r.join("\n")+"\n    </tbody></table>\n  ")+"\n<script>\n(function() {\n  var isExtensionLoaded = function () {\n    const $root = document.documentElement\n    return !!$root && !!$root.getAttribute('data-kantu')\n  }\n  var increaseCountInUrl = function (max) {\n    var url   = new URL(window.location.href)\n    var count = 1 + (parseInt(url.searchParams.get('reload') || 0))\n\n    url.searchParams.set('reload', count)\n    var nextUrl = url.toString()\n\n    var shouldStop = count > max\n    return [shouldStop, !shouldStop ? nextUrl : null]\n  }\n  var run = function () {\n    try {\n      var evt = new CustomEvent('kantuSaveAndRunMacro', {\n        detail: {\n          html: document.documentElement.outerHTML,\n          noImport: "+(o||"false")+",\n          storageMode: '"+Object(l.getStorageManager)().getCurrentStrategyType()+"'\n        }\n      })\n\n      window.dispatchEvent(evt)\n      var intervalTimer = setInterval(() => window.dispatchEvent(evt), 1000);\n\n      if (window.location.protocol === 'file:') {\n        var onInvokeSuccess = function () {\n          clearTimeout(timer)\n          clearTimeout(reloadTimer)\n          clearInterval(intervalTimer)\n          window.removeEventListener('kantuInvokeSuccess', onInvokeSuccess)\n        }\n        var timer = setTimeout(function () {\n          alert('Error #203: It seems you need to turn on *Allow access to file URLs* for Kantu in your browser extension settings.')\n        }, 8000)\n\n        window.addEventListener('kantuInvokeSuccess', onInvokeSuccess)\n      }\n    } catch (e) {\n      alert('Kantu Bookmarklet error: ' + e.toString());\n    }\n  }\n  var reloadTimer = null\n  var main = function () {\n    if (isExtensionLoaded())  return run()\n\n    var MAX_TRY   = 3\n    var INTERVAL  = 1000\n    var tuple     = increaseCountInUrl(MAX_TRY)\n\n    if (tuple[0]) {\n      return alert('Error #204: It seems UI.Vision RPA is not installed yet - or you need to turn on *Allow access to file URLs* for UI.Vision RPA in your browser extension settings.')\n    } else {\n      reloadTimer = setTimeout(function () {\n        window.location.href = tuple[1]\n      }, INTERVAL)\n    }\n  }\n\n  setTimeout(main, 500)\n})();\n<\/script>\n</body>\n</html>\n  "}function f(e){var t=e.name,n=e.commands.map((function(e){return d({},e)})),r=n.find((function(e){return"open"===e.cmd}));return r&&(r.target=r.target),h({name:t,commandTrs:n.map((function(e){return"open"===e.cmd&&(e.target=e.target),"\n      <tr>\n        <td>"+(e.cmd||"")+"</td>\n        <td>"+(e.target||"")+"</td>\n        <td>"+(e.value||"")+"</td>\n      </tr>\n    "})),baseUrl:""})}function g(){return h({name:"UI.Vision Autostart Page",commandTrs:[],baseUrl:"",noImport:!0})}function m(e){return t=f(e),"data:text/html;base64,"+window.btoa(unescape(encodeURIComponent(t)));var t}function p(e){var t=a()("<div>"+e+"</div>"),n=t.find("link"),r=t.find("title"),o=t.find("tbody > tr"),i=n&&n.attr("href"),s=r.text();if(!s||!s.length)throw new Error("fromHtml: missing title");return{name:s,data:{commands:[].slice.call(o).map((function(e){var t=a()(e),n=t[0].outerHtml;t.find("datalist").remove();var r,o,s=t.children(),l=s.eq(0),d=s.eq(1),h=s.eq(2),f=Object(u.normalizeCommandName)(l&&l.text()),g=h&&h.text(),m=d&&d.text();if(!f||!f.length)throw new Error("missing cmd in "+n);return"open"===f&&(m=i&&i.length&&!/:\/\//.test(m)?(r=i,o=m,new c.a(o,r).toString()):m),{cmd:f,target:m,value:g}}))}}}function w(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=o()(e.replace(/^\s*/,"")),i=t?t.replace(/\.json$/i,""):r.Name||"__imported__";if(r.macros)throw new Error("This is a test suite, not a macro");if(!Array.isArray(r.Commands))throw new Error("'Commands' field must be an array");var a=r.Commands.map((function(e){var t={cmd:Object(u.normalizeCommandName)(e.Command),target:e.Target,value:e.Value,description:e.Description||""};return Array.isArray(e.Targets)&&(t.targetOptions=e.Targets),t}));return d({name:i,data:{commands:a}},n.withStatus&&r.status?{status:r.status}:{},n.withId&&r.id?{id:r.id}:{})}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=function(){var e=new Date;return[e.getFullYear(),e.getMonth()+1,e.getDate()].join("-")},r=d({Name:e.name,CreationDate:n(),Commands:e.commands.map((function(e){return{Command:e.cmd,Target:e.target||"",Value:e.value||"",Targets:t.ignoreTargetOptions?e.targetOptions:void 0,Description:e.description||""}}))},t.withStatus&&e.status?{status:e.status}:{},t.withId&&e.id?{id:e.id}:{});return JSON.stringify(r,null,2)}function v(e){return t=y(e),"data:text/json;base64,"+window.btoa(unescape(encodeURIComponent(t)));var t}function b(e){var t=e.path,n=e.bookmarkTitle;if(!t)throw new Error("path is required to generate bookmark for macro");if(!n)throw new Error("bookmarkTitle is required to generate bookmark for macro");return{title:n,url:("javascript:\n      (function() {\n        try {\n          var evt = new CustomEvent('kantuRunMacro', {\n            detail: {\n              name: "+JSON.stringify(t.replace(/\.json$/i,""))+",\n              from: 'bookmark',\n              storageMode: '"+Object(l.getStorageManager)().getCurrentStrategyType()+"',\n              closeRPA: 1\n            }\n          });\n          window.dispatchEvent(evt);\n        } catch (e) {\n          alert('UI.Vision RPA Bookmarklet error: ' + e.toString());\n        }\n      })();\n    ").replace(/\n\s*/g,"")}}function S(e){return'<!doctype html>\n<html lang="en">\n  <head>\n    <title>UI.Vision Shortcut Page</title>\n  </head>\n  <body>\n    <h3>Command line:</h3>\n    <a id="run" href="ui.vision.html?direct=1&savelog=log.txt&macro='+e+'">Click here</a>\n    <br>\n    <br>\n\t\x3c!-- To start another macro just edit this HTML file and change the macro name in the command line above^. --\x3e\n\t\x3c!-- For more command line parameters see https://ui.vision/rpa/docs#cmd --\x3e\n    <script>\n      window.location.href = document.getElementById("run").getAttribute("href");\n    <\/script>\n  </body>\n</html>\n'}},504:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(182);class o extends r.BaseProxyManager{constructor(){super(),this.isBound=!1}isSupported(){return"undefined"!=typeof chrome&&chrome.proxy&&chrome.proxy.settings&&chrome.proxy.settings.onChange}isControllable(e){return new Promise((t,n)=>{chrome.proxy.settings.get({incognito:!!e},e=>{if(chrome.runtime.lastError)return n(chrome.runtime.lastError);const{levelOfControl:r}=e,o=-1!==["controllable_by_this_extension","controlled_by_this_extension"].indexOf(r);t(o)})})}setProxy(e){return this.bindProxyChange(),this.proxy=e,new Promise((t,n)=>{chrome.proxy.settings.set({value:{mode:"fixed_servers",rules:{singleProxy:{scheme:e.type,host:e.host,port:parseInt(e.port,10)}}}},()=>{if(chrome.runtime.lastError)return n(chrome.runtime.lastError);t()})})}reset(){return new Promise((e,t)=>{chrome.proxy.settings.set({value:{mode:"direct"}},()=>{if(chrome.runtime.lastError)return t(chrome.runtime.lastError);e()})})}bindProxyChange(){this.isBound||(this.isBound=!0,chrome.proxy.settings.onChange.addListener(e=>{const t=this.fromChromeDetails(e);this.setLocalProxyIfIsNew(t),this.registry.fire("change",t)}))}fetchProxyFromSettings(){return new Promise((e,t)=>{chrome.proxy.settings.get({incognito:!1},n=>{if(chrome.runtime.lastError)return t(chrome.runtime.lastError);const r=this.fromChromeDetails(n);this.setLocalProxyIfIsNew(r),this.registry.fire("change",r),e()})})}fromChromeDetails(e){if("fixed_servers"!==e.value.mode||!e.value.rules||!e.value.rules.singleProxy)return null;const t=e.value.rules.singleProxy;return{host:t.host,port:""+t.port,type:t.scheme}}setLocalProxyIfIsNew(e){var t,n;(null==e?void 0:e.host)===(null===(t=this.proxy)||void 0===t?void 0:t.host)&&(null==e?void 0:e.port)===(null===(n=this.proxy)||void 0===n?void 0:n.port)||(this.proxy=e)}}t.ProxyManagerViaSettingsAPI=o},505:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(182),i=n(357),a=r(n(20)),s=r(n(11)),c=n(12);class u extends o.BaseProxyManager{constructor(){super(),this.unbind=()=>{},this.isBound=!1}isSupported(){return"undefined"!=typeof browser&&browser.proxy&&browser.proxy.register}isControllable(){return Promise.resolve(!0)}setProxy(e){return this.bind(),this.proxy=e,this.notifyProxyChange(),browser.runtime.sendMessage({cmd:"SET_PROXY",data:e?i.convertToFirefoxProxyInfo(e):null},{toProxyScript:!0}).then(()=>c.delay(()=>{},1e3))}reset(){return this.proxy=null,this.notifyProxyChange(),a.default.ask("PANEL_SET_PROXY_FOR_PAC",{proxy:null}).then(()=>c.delay(()=>{},1e3))}getAuth(e,t){return this.proxy&&this.proxy.username&&this.proxy.host===e&&this.proxy.port===t?{username:this.proxy.username,password:this.proxy.password}:null}notifyProxyChange(){setTimeout(()=>{this.registry.fire("change",this.proxy)},10)}bind(){if(this.isBound)return;this.isBound=!0;const e=e=>{"PROXY_LOG"===e.type&&s.default("PROXY_LOG",e)};browser.proxy.register("firefox_pac.js"),browser.runtime.onMessage.addListener(e),this.unbind=()=>{browser.proxy.unregister(),browser.runtime.onMessage.removeListener(e)}}}t.ProxyManagerViaPacAPI=u},506:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(10));t.ProxyHttpAuth=class{constructor(e){this.unbindListener=()=>{},this.bound=!1,this.getAuth=e.getAuth}bind(){if(this.bound)return;this.bound=!0;const e=this.onAuthRequired.bind(this);o.default.webRequest.onAuthRequired.addListener(e,{urls:["<all_urls>"]},["blocking"]),this.unbindListener=()=>o.default.webRequest.onAuthRequired.removeListener(e)}unbind(){this.bound&&(this.unbindListener(),this.bound=!1)}onAuthRequired(e){if(!e.isProxy)return{};const t=this.getAuth(e.challenger.host,""+e.challenger.port);return t?{authCredentials:t}:{}}}},511:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(76),i=r(n(92)),a=n(4),s=n(12);class c extends o.FlatStorage{constructor(e){super(),this.displayedCount=0,this.totalCount=0;const t=e.table;if(!i.default.tables.find(e=>e.name===t))throw new Error(`Unknown indexeddb table name '${t}'`);this.table=i.default.table(e.table)}getDisplayCount(){return this.displayedCount}getTotalCount(){return this.totalCount}__list(){return Promise.resolve(this.table.toArray()).then(e=>(this.totalCount=e.length,this.displayedCount=e.length,e.map(e=>({dir:"",fileName:e.name,lastModified:new Date,size:"unknown"}))))}exists(e){return Promise.resolve(this.table.where("name").equals(e).toArray()).then(e=>e.length>0)}read(e,t){if("Text"!==t)throw new Error(`ReadFileType '${t}' is not supported in indexeddb storage`);return this.findByName(e)}readAll(e="Text",t){return Promise.resolve(this.table.toArray()).then(e=>e.map(e=>({fileName:e.name,content:e})))}__write(e,t){return this.findByName(e).catch(()=>null).then(e=>{if(e){const n=this.normalize(Object.assign(Object.assign({},e),t));return delete n.id,this.table.update(e.id,n)}{const e=this.normalize(Object.assign({id:a.uid()},t));return this.table.add(e)}}).then(()=>{})}__overwrite(e,t){return this.write(e,t)}__clear(){return Promise.resolve(this.table.clear())}__remove(e){return this.findByName(e).then(e=>this.table.delete(e.id))}__rename(e,t){return this.findByName(e).then(e=>this.table.update(e.id,{name:t})).then(()=>{})}__copy(e,t){return this.findByName(e).then(e=>(delete e.id,e.name=t,this.__write(t,e)))}ensureDir(){return Promise.resolve()}findByName(e){return Promise.resolve(this.table.where("name").equals(e).first()).then(t=>{if(!t)throw new Error(`indexeddb storage: Item with name '${e}' is not found`);return t})}normalize(e){return e}dataToString(e){return JSON.stringify(e)}}t.IndexeddbFlatStorage=c,t.getIndexeddbFlatStorage=s.singletonGetterByKey(e=>e.table,e=>new c(e))},512:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(135)),i=n(185),a=n(12);t.MigrationService=class{constructor(e){this.storage=e.storage,this.jobs=e.jobs}isMigrated(e){return this.storage.get(e).then(e=>!!e)}getRecords(){return this.storage.getAll()}runType(e){return this.isMigrated(e).then(t=>{if(t)return i.MigrationResult.AlreadyMigrated;const n=this.findJob(e);return n?n.shouldMigrate().then(e=>e?n.migrate().then(()=>i.MigrationResult.Success):i.MigrationResult.NotQualified):i.MigrationResult.JobUnknown}).catch(e=>(console.error(e),i.MigrationResult.Error)).then(t=>t!==i.MigrationResult.Success?Promise.resolve(t):this.storage.set(e,{result:t,id:a.uid(),runAt:(new Date).getTime(),jobType:e}).then(()=>t))}runAll(e,t){const n=this.jobs.filter(t=>o.default.satisfies(e,t.previousVersionRange()));return a.flow(...n.map(e=>{const t=e.getType();return()=>this.runType(t).then(e=>({type:t,result:e}))})).then(e=>e.reduce((e,t)=>(e[t.type]=t.result,e),{}))}findJob(e){return this.jobs.find(t=>t.getType()===e)}}},513:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(153),o=n(12);class i extends r.KeyValueData{getAll(){return super.get("")}getMainKeyAndSubKeys(e){const[t,n]=super.getMainKeyAndSubKeys(e);return[i.STORAGE_KEY,[t].concat(n).filter(e=>e&&e.length)]}}t.MigrationKeyValueData=i,i.STORAGE_KEY="migration_records",t.getMigrationKeyValueData=o.singletonGetter(()=>new i)},60:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(124),i=n(125),a=n(12),s=r(n(11)),c=r(n(27)),u=n(126),l=n(127),d=n(4),h=r(n(135)),f=r(n(34));!function(e){e[e.UserProfile=0]="UserProfile",e[e.UserDesktop=1]="UserDesktop"}(t.SpecialFolder||(t.SpecialFolder={})),t.getNativeFileSystemAPI=a.singletonGetter(()=>{const e=new i.KantuFileAccessHost;let t=e.connectAsync().catch(e=>{throw s.default.warn("pReady - error",e),e}),n=0;const r=o.MethodTypeInvocationNames.reduce((o,i)=>{const s=a.snakeToCamel(i);return o[s]||(o[s]=o=>t.then(()=>(n+=1,e.invokeAsync(i,o))).then(e=>(n-=1,e),e=>{throw n-=1,r.reconnect().catch(()=>{}),e})),o},{reconnect:()=>a.until("pendingRequestCount === 0",()=>({pass:0===n,result:!0})).then(()=>(s.default("FileSystem - reconnect",(new Error).stack),e.disconnect(),t=e.connectAsync(),t.then(()=>r))),getEntries:e=>{const t=r;return t.getFileSystemEntries(e).then(n=>{const{errorCode:r,entries:o}=n;return e.brief?Promise.resolve({errorCode:r,entries:o.map(e=>({name:e,length:0,isDirectory:!1,lastWriteTime:0}))}):Promise.all(o.map(n=>{const r=c.default.join(e.path,n);return t.getFileSystemEntryInfo({path:r}).then(e=>({name:n,length:e.length,isDirectory:e.isDirectory,lastWriteTime:e.lastWriteTime}))})).then(e=>({errorCode:r,entries:e}))})},ensureDir:e=>{const t=r;return t.directoryExists({path:e.path}).then(n=>!!n||t.ensureDir({path:c.default.dirname(e.path)}).then(n=>!!n&&t.createDirectory({path:e.path}))).catch(e=>!1)},readBigFile:e=>{const t=r;return t.getFileSize(e).then(n=>{if(0===n)return new Uint8Array(0);const r=[],o=i=>t.readFileRange({path:e.path,rangeStart:i}).then(e=>{const t=l.base64.decode(e.buffer);if(t)for(let e=0;e<t.length;e++)r.push(t[e]);return e.rangeEnd<=i||e.rangeEnd>=n?new Uint8Array(r):o(e.rangeEnd)});return o(0)})},isReadBigFileSupported:()=>r.getVersion().then(e=>!h.default.lt(e,f.default.xfile.minVersionToReadBigFile)),readAllTextCompat:e=>{const t=r;return t.isReadBigFileSupported().then(n=>n?t.readBigFile(e).then(e=>({errorCode:0,content:u.utf8.decode(e)})):t.readAllText(e))},readAllBytesCompat:e=>{const t=r;return t.isReadBigFileSupported().then(n=>n?t.readBigFile(e).then(e=>d.blobToDataURL(new Blob([e])).then(e=>({errorCode:0,content:e}))):t.readAllBytes(e))}});return r})},63:function(e,t,n){"use strict";n.r(t),n.d(t,"postMessage",(function(){return i})),n.d(t,"onMessage",(function(){return a}));var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o="SELENIUM_IDE_CS_MSG",i=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"*",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;return new Promise((function(a,s){if(!e||!e.postMessage)throw new Error("csPostMessage: targetWin is not a window");if(!t||!t.addEventListener||!t.removeEventListener)throw new Error("csPostMessage: myWin is not a window",t);var c=Math.random();t.addEventListener("message",(function e(n){if(n.data&&n.data.type===o&&!n.data.isRequest&&n.data.secret===c){t.removeEventListener("message",e);var r=n.data,i=r.payload,u=r.error;if(u)return s(new Error(u));if(void 0!==i)return a(i);s(new Error("csPostMessage: No payload nor error found"))}})),e.postMessage({type:"SELENIUM_IDE_CS_MSG",secret:c,payload:n,isRequest:!0},r),setTimeout((function(){s(new Error("csPostMessage: timeout "+i+" ms"))}),i)}))},a=function(e,t){if(!e||!e.addEventListener||!e.removeEventListener)throw new Error("csOnMessage: not a window",e);var n=function(e){if(e&&e.data&&e.data.type===o&&e.data.isRequest&&e.data.secret){var n={type:o,secret:e.data.secret};new Promise((function(n,r){var o=void 0;try{o=t(e.data.payload,{source:e.source})}catch(e){r(e)}void 0!==o&&n(o)})).then((function(t){e.source.postMessage(r({},n,{payload:t}),"*")}),(function(t){e.source.postMessage(r({},n,{error:t.message}),"*")}))}};return e.addEventListener("message",n),function(){return e.removeEventListener("message",n)}}},65:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(12),a=o(n(10));t.createTab=e=>a.default.tabs.create({url:e,active:!0}),t.activateTab=(e,t=!1)=>a.default.tabs.get(e).then(e=>(t?a.default.windows.update(e.windowId,{focused:!0}):Promise.resolve()).then(()=>a.default.tabs.update(e.id,{active:!0})).then(()=>e)),t.getTab=e=>a.default.tabs.get(e),t.getCurrentTab=e=>(e?a.default.windows.get(e):a.default.windows.getLastFocused()).then(e=>a.default.tabs.query({active:!0,windowId:e.id}).then(e=>e[0])),t.updateUrlForTab=function(e,n){var o;return r(this,void 0,void 0,(function*(){const r="number"==typeof e?yield a.default.tabs.get(e):e,s=new URL(r.url),c=new URL(n);return s.origin+s.pathname===c.origin+s.pathname&&!!(null===(o=c.hash)||void 0===o?void 0:o.length)&&(yield a.default.tabs.update(r.id,{url:"about:blank"}),yield i.delay(()=>{},100)),yield a.default.tabs.update(r.id,{url:n}),yield t.getTab(r.id)}))}},653:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r,o,i=n(10),a=n.n(i),s=n(4),c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u=(r={connected:null,cleanupTimer:null},o=function(e){c(r,e)},function(e,t){var n=function(e){return n=e,(t=r.connected)&&n&&t.tabId&&n.tabId&&t.tabId===n.tabId?(r.cleanupTimer&&clearTimeout(r.cleanupTimer),o({cleanupTimer:null}),Promise.resolve()):i(r.connected).then((function(){return a.a.debugger.attach(e,"1.2")})).then((function(){return o({connected:e})}));var t,n},i=function(e){return e?a.a.debugger.detach(e).then((function(){r.cleanupTimer&&clearTimeout(r.cleanupTimer),o({connected:null,cleanupTimer:null})}),(function(e){return console.error("error in detach",e.stack)})):Promise.resolve()},s=function(t,n){return a.a.debugger.sendCommand(e,t,n)},c=function(e){a.a.debugger.onEvent.addListener(e)},u=function(e){a.a.debugger.onDetach.addListener(e)};return new Promise((function(r,a){var l=function(t,n){var s;return s=setTimeout((function(){return i(e)}),0),o({cleanupTimer:s}),t?a(t):r(n)};return n(e).then((function(){t({sendCommand:s,onEvent:c,onDetach:u,done:l})}),(function(e){return a(e)}))}))}),l=function(e){var t=e.tabId,n=e.selector,r=e.files;return u({tabId:t},(function(e){return Object(s.composePromiseFn)(function(e){var t=e.sendCommand;e.done;return Object(s.partial)((function(e,n){return t("DOM.setFileInputFiles",{nodeId:n,files:e}).then((function(){return!0}))}))}(e)(r),function(e){var t=e.sendCommand;e.done;return Object(s.partial)((function(e,n){return t("DOM.querySelector",{nodeId:n,selector:e}).then((function(e){return e&&e.nodeId}))}))}(e)(n),(function(e){return e.nodeId}),function(e){var t=e.sendCommand;e.done;return function(){return t("DOM.getDocument").then((function(e){return e.root}))}}(e))().then((function(t){return e.done(null,t)}))}))}},654:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1080),o=n(1082),i=n(91);let a=!1,s=new r.WorkerConnection("/worker.js",(function(e){switch(e.type){case 0:a=!0;break;default:console.error("Unsupported worker message: ",e)}}));function c(e){if(!a)throw new Error("Module is not ready yet.");const t=Math.max(.1,Math.min(1,e.minSimilarity)),{allowSizeVariation:n,enableGreenPinkBoxes:r}=e;return Promise.all([o.ImageHelper.loadImageDataAsync(e.targetImageUrl),o.ImageHelper.loadImageDataAsync(e.patternImageUrl)]).then(([o,a])=>function(e,t,n,r,o){const i={image:e,pattern:t,options:{minSimilarity:n,allowSizeVariation:r,enableGreenPinkBoxes:o,requireGreenPinkBoxes:o}};return s.postJobAsync(2,i)}(o,a,t,n,r).then(t=>{i.guardSearchResult(t);const{containsGreenPinkBoxes:n,errorCode:r,regions:o}=t;return o.map(t=>({offsetLeft:t.rect.left/e.scaleDownRatio,offsetTop:t.rect.top/e.scaleDownRatio,viewportLeft:t.rect.left/e.scaleDownRatio+e.viewportOffsetX,viewportTop:t.rect.top/e.scaleDownRatio+e.viewportOffsetY,pageLeft:t.rect.left/e.scaleDownRatio+e.pageOffsetX,pageTop:t.rect.top/e.scaleDownRatio+e.pageOffsetY,width:t.rect.width/e.scaleDownRatio,height:t.rect.height/e.scaleDownRatio,score:t.score}))}))}t.searchImageBestOne=function(e){return c(e).then(e=>e[0])},t.searchImage=c},69:function(e,t,n){"use strict";n.r(t),n.d(t,"stringifyTestSuite",(function(){return c})),n.d(t,"parseTestSuite",(function(){return u})),n.d(t,"validateTestSuiteText",(function(){return l})),n.d(t,"toBookmarkData",(function(){return d})),n.d(t,"toHtml",(function(){return h}));n(108);var r=n(66),o=n.n(r),i=n(4),a=n(13),s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=s({creationDate:Object(i.formatDate)(new Date),name:e.name,macros:e.cases.map((function(e){var t=parseInt(e.loops,10);return{macro:e.testCaseId,loops:t}}))},t.withFold?{fold:!!e.fold}:{},t.withId&&e.id?{id:e.id}:{},t.withPlayStatus&&e.playStatus?{playStatus:e.playStatus}:{});return JSON.stringify(n,null,2)},u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=o()(e.replace(/^\s*/,""));if("string"!=typeof n.name||0===n.name.length)throw new Error("name must be a string");if(!Array.isArray(n.macros))throw new Error("macros must be an array");var r=n.macros.map((function(e){return("number"!=typeof e.loops||e.loops<1)&&(e.loops=1),{testCaseId:e.macro,loops:e.loops}})),i=s({cases:r,name:t.fileName?t.fileName.replace(/\.json$/i,""):n.name},t.withFold?{fold:void 0===n.fold||n.fold}:{},t.withId&&n.id?{id:n.id}:{},t.withPlayStatus&&n.playStatus?{playStatus:n.playStatus}:{});return i},l=u,d=function(e){var t=e.name,n=e.bookmarkTitle;if(!t)throw new Error("name is required to generate bookmark for test suite");if(!n)throw new Error("bookmarkTitle is required to generate bookmark for test suite");return{title:n,url:("javascript:\n      (function() {\n        try {\n          var evt = new CustomEvent('kantuRunTestSuite', {\n            detail: {\n              name: '"+t+"',\n              from: 'bookmark',\n              storageMode: '"+Object(a.getStorageManager)().getCurrentStrategyType()+"',\n              closeRPA: 1\n            }\n          });\n          window.dispatchEvent(evt);\n        } catch (e) {\n          alert('UI.Vision RPA Bookmarklet error: ' + e.toString());\n        }\n      })();\n    ").replace(/\n\s*/g,"")}},h=function(e){var t=e.name;return'<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">\n<head>\n<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />\n<title>'+t+"</title>\n</head>\n<body>\n<h1>"+t+"</h1>\n<script>\n(function() {\n  var isExtensionLoaded = function () {\n    const $root = document.documentElement\n    return !!$root && !!$root.getAttribute('data-kantu')\n  }\n  var increaseCountInUrl = function (max) {\n    var url   = new URL(window.location.href)\n    var count = 1 + (url.searchParams.get('reload') || 0)\n\n    url.searchParams.set('reload', count)\n    var nextUrl = url.toString()\n\n    var shouldStop = count > max\n    return [shouldStop, !shouldStop ? nextUrl : null]\n  }\n  var run = function () {\n    try {\n      var evt = new CustomEvent('kantuRunTestSuite', { detail: { name: '"+t+"', from: 'html', storageMode: '"+Object(a.getStorageManager)().getCurrentStrategyType()+"' } })\n\n      window.dispatchEvent(evt)\n      var intervalTimer = setInterval(() => window.dispatchEvent(evt), 1000);\n\n      if (window.location.protocol === 'file:') {\n        var onInvokeSuccess = function () {\n          clearTimeout(timer)\n          clearTimeout(reloadTimer)\n          clearInterval(intervalTimer)\n          window.removeEventListener('kantuInvokeSuccess', onInvokeSuccess)\n        }\n        var timer = setTimeout(function () {\n          alert('Error #201: It seems you need to turn on *Allow access to file URLs* for Kantu in your browser extension settings.')\n        }, 8000)\n\n        window.addEventListener('kantuInvokeSuccess', onInvokeSuccess)\n      }\n    } catch (e) {\n      alert('UI.Vision RPA Bookmarklet error: ' + e.toString());\n    }\n  }\n  var main = function () {\n    if (isExtensionLoaded())  return run()\n\n    var MAX_TRY   = 3\n    var INTERVAL  = 1000\n    var tuple     = increaseCountInUrl(MAX_TRY)\n\n    if (tuple[0]) {\n      return alert('Error #202: It seems UI.Vision RPA is not installed yet, *or* you need to turn on *Allow access to file URLs* for UI.Vision RPA.')\n    } else {\n      setTimeout(function () {\n        window.location.href = tuple[1]\n      }, INTERVAL)\n    }\n  }\n\n  main()\n})();\n<\/script>\n</body>\n</html>\n  "}},70:function(e,t,n){var r,o=o||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,n=function(){return e.URL||e.webkitURL||e},r="moz-extension:"===window.location.protocol?function(){var e=t.createElementNS("http://www.w3.org/1999/xhtml","iframe");e.id="downloadFrame",e.style.visibility="hidden",e.style.position="absolute",e.style.left="-999px",t.body.appendChild(e);var n=e.contentDocument.createElement("a");return setTimeout((function(){e.contentDocument.body.appendChild(n)})),n}():t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in r,i=/constructor/i.test(e.HTMLElement)||e.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent),s=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},c=function(e){setTimeout((function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()}),4e4)},u=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},l=function(t,l,d){d||(t=u(t));var h,f=this,g="application/octet-stream"===t.type,m=function(){!function(e,t,n){for(var r=(t=[].concat(t)).length;r--;){var o=e["on"+t[r]];if("function"==typeof o)try{o.call(e,n||e)}catch(e){s(e)}}}(f,"writestart progress write writeend".split(" "))};if(f.readyState=f.INIT,o)return h=n().createObjectURL(t),void setTimeout((function(){var e,t;r.href=h,r.download=l,e=r,t=new MouseEvent("click"),e.dispatchEvent(t),m(),c(h),f.readyState=f.DONE}));!function(){if((a||g&&i)&&e.FileReader){var r=new FileReader;return r.onloadend=function(){var t=a?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,f.readyState=f.DONE,m()},r.readAsDataURL(t),void(f.readyState=f.INIT)}(h||(h=n().createObjectURL(t)),g)?e.location.href=h:e.open(h,"_blank")||(e.location.href=h);f.readyState=f.DONE,m(),c(h)}()},d=l.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=u(e)),navigator.msSaveOrOpenBlob(e,t)}:(d.abort=function(){},d.readyState=d.INIT=0,d.WRITING=1,d.DONE=2,d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null,function(e,t,n){return new l(e,t||e.name||"download",n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */e.exports?e.exports.saveAs=o:null!==n(551)&&null!==n(433)&&(void 0===(r=function(){return o}.call(t,n,t,e))||(e.exports=r))},74:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(90),o=n(91),i=n(12);class a extends r.XModule{getName(){return r.XModuleTypes.XDesktop}getAPI(){return o.getNativeCVAPI()}initConfig(){return this.getConfig()}sanityCheck(){return Promise.all([this.getConfig(),this.getAPI().getVersion().then(()=>this.getAPI(),()=>this.getAPI().reconnect()).catch(e=>{throw new Error("Error #301: Visual Desktop Automation XModule is not installed yet")})]).then(()=>!0)}checkUpdate(){return Promise.reject(new Error("checkUpdate is not implemented yet"))}checkUpdateLink(e,t){return`https://ui.vision/x/idehelp?help=xdesktop_updatecheck&xversion=${e}&kantuversion=${t}`}downloadLink(){return"https://ui.vision/x/idehelp?help=xdesktop_download"}infoLink(){return"https://ui.vision/x/idehelp?help=xdesktop"}}t.XDesktop=a,t.getXDesktop=i.singletonGetter(()=>new a)},75:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(90),o=n(12),i=n(359);class a extends r.XModule{getName(){return r.XModuleTypes.XScreenCapture}getAPI(){return i.getNativeScreenCapture()}initConfig(){return this.getConfig()}sanityCheck(){return Promise.all([this.getConfig(),this.getAPI().getVersion().catch(e=>{throw new Error("Error #301: Screen Capture XModule is not installed yet")})]).then(()=>!0)}checkUpdate(){return Promise.reject(new Error("checkUpdate is not implemented yet"))}checkUpdateLink(e,t){return`https://ui.vision/x/idehelp?help=xscreencapture_updatecheck&xversion=${e}&kantuversion=${t}`}downloadLink(){return"https://ui.vision/x/idehelp?help=xscreencapture_download"}infoLink(){return"https://ui.vision/x/idehelp?help=xscreencapture"}}t.XScreenCapture=a,t.getXScreenCapture=o.singletonGetter(()=>new a)},76:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(81)),i=n(79),a=n(4),s=n(12);var c;!function(e){e.ListChanged="list_changed",e.FilesChanged="files_changed"}(c=t.FlatStorageEvent||(t.FlatStorageEvent={}));class u extends o.default{constructor(e={}){super(),this.encode=(e,t)=>e,this.decode=(e,t)=>e,this.emitListChanged=i(()=>{this.list().then(e=>{this.emit(c.ListChanged,e)})},100),this.changedFileNames=[],this.__emitFilesChanged=i(()=>{const e=this.changedFileNames;return this.changedFileNames=[],Promise.all(e.map(e=>this.read(e,"Text").catch(()=>null))).then(t=>{if(0===t.length)return;const n=t.map((t,n)=>({content:t,fileName:e[n]})).filter(e=>!!e.content);this.emit(c.FilesChanged,n)})},100),e.decode&&(this.decode=e.decode),e.encode&&(this.encode=e.encode)}list(){return this.__list().then(e=>(e.sort((e,t)=>{const n=e.fileName.toLowerCase(),r=t.fileName.toLowerCase();return n<r?-1:n>r?1:0}),e))}readAll(e="Text",t){return this.list().then(t=>Promise.all(t.map(t=>this.read(t.fileName,e).then(e=>({content:e,fileName:t.fileName})))))}bulkWrite(e){return Promise.all(e.map(e=>this.write(e.fileName,e.content))).then(()=>{})}write(e,t){return this.exists(e).then(n=>this.__write(e,t).then(()=>{n||this.emitListChanged(),this.emitFilesChanged([e])}))}overwrite(e,t){return this.__overwrite(e,t).then(()=>{this.emitFilesChanged([e])})}clear(){return this.__clear().then(()=>{this.emitListChanged()})}remove(e){return this.__remove(e).then(()=>{this.emitListChanged()})}rename(e,t){return this.__rename(e,t).then(()=>{this.emitListChanged(),this.emitFilesChanged([t])})}copy(e,t){return(t&&t.length?Promise.resolve(t):s.uniqueName(e,{generate:(e,t=1)=>{const n=/-(\d+)$/;return e.match(n)?e.replace(n,(e,n)=>`-${parseInt(n,10)+t}`):`${e}-${t}`},check:e=>this.exists(e).then(e=>!e),postfixReg:/(_relative)?\.\w+$/})).then(t=>this.__copy(e,t).then(()=>{this.emitListChanged(),this.emitFilesChanged([t])}))}emitFilesChanged(e){this.changedFileNames=e.reduce((e,t)=>(-1===e.indexOf(t)&&e.push(t),e),this.changedFileNames),this.__emitFilesChanged()}}t.FlatStorage=u,t.readableSize=e=>e<1024?e+" byte":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB",t.checkFileName=function(e){a.withFileExtension(e,t=>{try{a.validateStandardName(t,!0)}catch(t){throw new Error(`Invalid file name '${e}'. File name `+t.message)}return t})}},87:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){let t,n,r;!function(e){e.DisplayVisualResult="display_visual_result",e.DisplayOcrResult="display_ocr_result",e.Capture="capture"}(t=e.RequestType||(e.RequestType={})),function(e){e[e.Storage=0]="Storage",e[e.HardDrive=1]="HardDrive",e[e.CV=2]="CV",e[e.DataUrl=3]="DataUrl"}(n=e.ImageSource||(e.ImageSource={})),function(e){e[e.Match=0]="Match",e[e.Reference=1]="Reference",e[e.BestMatch=2]="BestMatch",e[e.ReferenceOfBestMatch=3]="ReferenceOfBestMatch"}(r=e.RectType||(e.RectType={}))}(t.DesktopScreenshot||(t.DesktopScreenshot={}))},89:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(81)),i=n(79),a=n(12),s=n(27),c=n(122);var u,l;!function(e){e.ListChanged="list_changed",e.FilesChanged="files_changed"}(u=t.StorageEvent||(t.StorageEvent={})),function(e){e[e.Unknown=0]="Unknown",e[e.NonExistent=1]="NonExistent",e[e.File=2]="File",e[e.Directory=3]="Directory"}(l=t.EntryStatus||(t.EntryStatus={}));class d extends o.default{constructor(e={}){super(),this.encode=(e,t)=>e,this.decode=(e,t)=>e,this.displayedCount=0,this.totalCount=0,this.listFilter=e=>e,this.emitListChanged=i(()=>{this.list("/").then(e=>{this.emit(u.ListChanged,e)})},100),this.changedFileNames=[],this.__emitFilesChanged=i(()=>{const e=this.changedFileNames;return this.changedFileNames=[],Promise.all(e.map(e=>this.read(e,"Text").catch(()=>null))).then(t=>{if(0===t.length)return;const n=t.map((t,n)=>({content:t,fileName:e[n]})).filter(e=>!!e.content);this.emit(u.FilesChanged,n)})},100),e.decode&&(this.decode=e.decode),e.encode&&(this.encode=e.encode),e.listFilter&&(this.listFilter=e.listFilter)}getPathLib(){return this.isWin32Path()?s.win32:s.posix}relativePath(e,t){const n=t?this.dirPath(e):this.filePath(e),r=this.dirPath("/");return this.getPathLib().relative(r,n)}entryPath(e,t){return t?this.dirPath(e):this.filePath(e)}list(e="/",t=!1){return this.__list(e,t).then(e=>this.sortEntries(e))}listR(e="/"){const t=e=>this.list(e,!1).then(e=>Promise.all(e.map(e=>e.isDirectory?t(e.fullPath):Promise.resolve(null))).then(t=>this.sortEntries(e.map((e,n)=>Object.assign(Object.assign({},e),{children:t[n]||[]})))));return t(e).then(t=>"/"!==e?t:Promise.resolve(this.listFilter(t)).then(e=>(this.totalCount=a.sum(...t.map(a.nodeCount)),this.displayedCount=a.sum(...e.map(a.nodeCount)),e)))}getDisplayCount(){return this.displayedCount}getTotalCount(){return this.totalCount}exists(e){return this.stat(e).then(({isFile:e,isDirectory:t})=>e||t,()=>!1)}fileExists(e){return this.stat(e).then(e=>e.isFile,()=>!1)}directoryExists(e){return this.stat(e,!0).then(e=>e.isDirectory,()=>!1)}readR(e,t="Text",n){return this.listR(e).then(e=>Promise.all(e.map(e=>{if(e.isFile)return this.read(e.fullPath,t).then(t=>[{content:t,filePath:e.fullPath}]);if(e.isDirectory)return this.readR(e.fullPath,t);throw new Error("Not file or directory")})).then(e=>a.flatten(e)))}write(e,t){return this.exists(e).then(n=>this.__write(e,t).then(()=>{n||this.emitListChanged(),this.emitFilesChanged([e])}))}overwrite(e,t){return this.__overwrite(e,t).then(()=>{this.emitFilesChanged([e])})}bulkWrite(e){return Promise.all(e.map(e=>this.write(e.filePath,e.content))).then(()=>{})}removeFile(e){return this.__removeFile(e).then(()=>{this.emitListChanged()})}removeEmptyDirectory(e){return this.__removeEmptyDirectory(e).then(()=>{this.emitListChanged()})}removeDirectory(e){return this.remove(e,!0)}remove(e,t){return this.stat(e,t).then(e=>{if(e.isFile)return this.removeFile(e.fullPath);if(e.isDirectory)return this.list(e.fullPath).then(t=>Promise.all(t.map(e=>this.remove(e.fullPath,e.isDirectory))).then(()=>this.removeEmptyDirectory(e.fullPath)));throw new Error("Not file or directory")})}clear(){return this.list("/").then(e=>Promise.all(e.map(e=>this.remove(e.fullPath))).then(()=>{}))}moveFile(e,t){return this.__moveFile(e,t).then(()=>{this.emitListChanged()})}copyFile(e,t){return this.__copyFile(e,t).then(()=>{this.emitListChanged()})}moveDirectory(e,t){return this.move(e,t,!0,!0)}copyDirectory(e,t){return this.copy(e,t,!0,!0)}move(e,t,n,r){const o=this.entryPath(e,n),i=this.entryPath(t,r);if(o===i)throw new Error("move: src should not be the same as dst");if(this.getPathLib().dirname(o)===i)throw new Error("move: cannot move to original dir");if(n&&r&&this.isTargetInSourceDirectory(t,e))throw new Error("Cannot move a directory into its sub directory");return this.copy(e,t,n,r).then(()=>this.remove(e,n))}copy(e,t,n,r){const o=this.getPathLib().dirname(e)===this.getPathLib().dirname(t);if(e===t)throw new Error("copy: dst should not be the same as src");return Promise.all([this.getEntryStatus(e,n),this.getEntryStatus(t,r),o?Promise.resolve(l.Directory):this.getEntryStatus(this.getPathLib().dirname(t),!0)]).then(n=>{const[r,o,i]=n;if(i!==l.Directory)throw new c.ENOTDIR(this.getPathLib().dirname(t));switch(r){case l.NonExistent:throw new c.ENOENT(e);case l.Unknown:throw new Error(`source (${e}) exists but is neither a file nor a directory`);case l.File:switch(o){case l.File:throw new c.EEXIST(t);case l.Unknown:throw new Error(`dst '${t}' is neither a file nor directory`);case l.Directory:{const n=this.getPathLib().resolve(t,this.getPathLib().basename(e));return this.copyFile(e,n)}case l.NonExistent:return this.copyFile(e,t)}case l.Directory:switch(o){case l.File:throw new Error(`dst '${t}' is an existing file, but src '${e}' is a directory`);case l.Unknown:throw new Error(`dst '${t}' is neither a file nor directory`);case l.Directory:{if(this.isTargetInSourceDirectory(t,e))throw new Error("Cannot copy a directory into its sub directory");const n=this.getPathLib().resolve(t,this.getPathLib().basename(e));return this.ensureDirectory(n).then(()=>this.copyAllInDirectory(e,n))}case l.NonExistent:return this.ensureDirectory(t).then(()=>this.copyAllInDirectory(e,t))}}})}createDirectory(e){return this.mkdir(e,!1)}ensureDirectory(e){return this.getEntryStatus(e,!0).then(t=>{switch(t){case l.File:case l.Unknown:throw new c.EEXIST;case l.Directory:return;case l.NonExistent:return this.mkdir(e,!0)}})}ensureDir(){return this.ensureDirectory("/")}rename(e,t){return this.move(e,t)}readAll(e="Text",t){return this.list("/").then(n=>Promise.all(n.filter(e=>e.isFile).map(t=>this.read(t.fullPath,e).then(e=>({content:e,fileName:t.name})).catch(e=>({fileName:t.name,fullFilePath:t.fullPath,error:new Error(`Error in parsing ${t.fullPath}:\n${e.message}`)})))).then(e=>{const n=e.filter(e=>e.error);return t&&t(n),e.filter(e=>e.content)}))}isTargetInSourceDirectory(e,t){const n=this.dirPath(e),r=this.dirPath(t),o=this.getPathLib().sep;return-1===this.getPathLib().relative(r,n).split(o).indexOf("..")}sortEntries(e){const t=[...e];return t.sort((e,t)=>{if(e.isDirectory&&t.isFile)return-1;if(e.isFile&&t.isDirectory)return 1;const n=e.name.toLowerCase(),r=t.name.toLowerCase();return n<r?-1:n>r?1:0}),t}copyAllInDirectory(e,t){return this.list(e).then(e=>Promise.all(e.map(e=>{if(e.isFile)return this.copyFile(e.fullPath,this.getPathLib().resolve(t,e.name));if(e.isDirectory){const n=this.getPathLib().resolve(t,e.name);return this.ensureDirectory(n).then(()=>this.copyAllInDirectory(e.fullPath,n))}return Promise.resolve()})).then(()=>{}))}mkdir(e,t=!1){return(()=>t?Promise.resolve():this.getEntryStatus(e,!0).then(t=>{if(t!==l.NonExistent)throw new c.EEXIST(e)}))().then(()=>{const t=this.getPathLib().dirname(e);return"/"===t?this.__createDirectory(e):this.getEntryStatus(t,!0).then(n=>{switch(n){case l.File:case l.Unknown:throw new c.EEXIST(t);case l.Directory:return this.__createDirectory(e);case l.NonExistent:return this.mkdir(t,!0).then(()=>this.__createDirectory(e))}})}).then(()=>{this.emitListChanged()})}getEntryStatus(e,t){return this.stat(e,t).then(e=>e.isFile?l.File:e.isDirectory?l.Directory:l.NonExistent,e=>l.NonExistent)}emitFilesChanged(e){this.changedFileNames=e.reduce((e,t)=>(-1===e.indexOf(t)&&e.push(t),e),this.changedFileNames),this.__emitFilesChanged()}}t.StandardStorage=d},90:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(36));!function(e){e.XFile="xFile",e.XUserIO="xClick",e.XDesktop="xDesktop",e.XScreenCapture="xScreenCapture"}(t.XModuleTypes||(t.XModuleTypes={}));t.XModule=class{constructor(){this.cachedConfig={},this.initConfig()}getVersion(){return this.getAPI().reconnect().catch(e=>{throw new Error(`${this.getName()} is not installed yet`)}).then(e=>e.getVersion().then(e=>({version:e,installed:!0}))).catch(e=>({installed:!1}))}setConfig(e){return this.cachedConfig=Object.assign(Object.assign({},this.cachedConfig),e),this.getConfig().then(t=>{const n=Object.assign(Object.assign({},t),e);return o.default.set(this.getStoreKey(),n).then(e=>(e&&(this.cachedConfig=n),e))})}getConfig(){return o.default.get(this.getStoreKey()).then(e=>(this.cachedConfig=e||{},this.cachedConfig))}getCachedConfig(){return this.cachedConfig}getStoreKey(){return this.getName().toLowerCase()}}},91:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(344),i=n(12),a=n(345),s=n(346),c=n(4),u=n(22),l=r(n(11)),d=r(n(27));function h(e){switch(e.errorCode){case 0:return e;case 2:throw new Error("Cannot find green and/or pink boxes");case 3:throw new Error("Pattern image contains green box but does not contain pink box");case 4:throw new Error("Pattern image contains more than one green box");case 5:throw new Error("Pattern image contains more than one pink box");case 1:throw new Error("Unspecified error has occured");default:throw new Error(`Unknown error code ${e.errorCode}`)}}function f(e,t,n){const r=e.width,o=e.height,i=e.data,a=new Uint8Array(r*o*3);for(let e=0;e<o;++e)for(let t=0;t<r;++t){const n=e*r+t,o=3*n,s=4*n;a[o+0]=i[s+0],a[o+1]=i[s+1],a[o+2]=i[s+2]}return{width:r,height:o,dpiX:t,dpiY:n,data:s.base64.encode(a)}}function g(e,t,n){return u.imageDataFromUrl(e).then(e=>f(e,t,n))}t.getNativeCVAPI=i.singletonGetter(()=>{const e=new a.KantuCVHost;let t=e.connectAsync().catch(e=>{throw l.default.warn("pReady - error",e),e});const n=o.MethodTypeInvocationNames.reduce((r,o)=>{const a=i.snakeToCamel(o);return r[a]=r=>t.then(()=>e.invokeAsync(o,r).catch(e=>{if(n.reconnect().catch(()=>{}),"captureDesktop"===a){const e=r.path;if(e&&/[\\/]/.test(e))throw new Error(`Failed to captureDesktop, please confirm directory exists at '${d.default.dirname(e)}'`)}throw e})),r},{reconnect:()=>(e.disconnect(),t=e.connectAsync(),t.then(()=>n)),searchDesktopWithGuard:e=>n.searchDesktop(e).then(h),getImageFromDataUrl:(e,t)=>n.getImageInfo({content:(e=>{const t=e.indexOf("base64,");return-1===t?e:e.substr(t+"base64,".length)})(e)}).then(n=>{const r=n.dpiX||t||96,o=n.dpiY||t||96;return g(e,r,o)}),readFileAsArrayBuffer:e=>{const t=n,r=(e,n=1/0,o=0,i=[])=>t.readFileRange({rangeStart:o,path:e}).then(t=>{const o=t.rangeEnd>t.rangeStart?i.concat([t.buffer]):i;return t.rangeEnd>=n||t.rangeEnd<=t.rangeStart?o:r(e,n,t.rangeEnd,o)});return t.getFileSize({path:e}).then(t=>r(e,t,0,[])).then(e=>i.concatUint8Array(...e.map(e=>new Uint8Array(c.dataURItoArrayBuffer(e)))).buffer)},readFileAsBlob:e=>n.readFileAsArrayBuffer(e).then(e=>new Blob([e])),readFileAsDataURL:(e,t=!0)=>n.readFileAsBlob(e).then(e=>c.blobToDataURL(e,t)),readFileAsText:e=>n.readFileAsBlob(e).then(e=>c.blobToText(e)),readFileAsBinaryString:e=>n.readFileAsArrayBuffer(e).then(e=>c.arrayBufferToString(e))});return n}),t.guardSearchResult=h,t.convertImageSearchResult=function(e,t=1,n){const{errorCode:r,containsGreenPinkBoxes:o,regions:i}=e;return i.map(e=>(e=>{var r,o;const i=null!==(r=null==n?void 0:n.x)&&void 0!==r?r:0,a=null!==(o=null==n?void 0:n.y)&&void 0!==o?o:0;return e.relativeRect?{matched:{offsetLeft:t*e.relativeRect.x-t*i,offsetTop:t*e.relativeRect.y-t*a,viewportLeft:t*e.relativeRect.x,viewportTop:t*e.relativeRect.y,pageLeft:t*e.relativeRect.x,pageTop:t*e.relativeRect.y,width:t*e.relativeRect.width,height:t*e.relativeRect.height,score:e.score},reference:{offsetLeft:t*e.matchedRect.x-t*i,offsetTop:t*e.matchedRect.y-t*a,viewportLeft:t*e.matchedRect.x,viewportTop:t*e.matchedRect.y,pageLeft:t*e.matchedRect.x,pageTop:t*e.matchedRect.y,width:t*e.matchedRect.width,height:t*e.matchedRect.height,score:e.score}}:{matched:{offsetLeft:t*e.matchedRect.x-t*i,offsetTop:t*e.matchedRect.y-t*a,viewportLeft:t*e.matchedRect.x,viewportTop:t*e.matchedRect.y,pageLeft:t*e.matchedRect.x,pageTop:t*e.matchedRect.y,width:t*e.matchedRect.width,height:t*e.matchedRect.height,score:e.score},reference:null}})(e))},t.serializeImageData=f,t.serializeDataUrl=g},92:function(e,t,n){"use strict";n.r(t);var r=n(395),o=new(n.n(r).a)("selenium-ide");o.version(1).stores({testCases:"id,name,updateTime"}),o.version(2).stores({testCases:"id,name,updateTime",testSuites:"id,name,updateTime"}),o.open(),t.default=o},94:function(e,t,n){"use strict";n.d(t,"h",(function(){return u})),n.d(t,"c",(function(){return l})),n.d(t,"g",(function(){return h})),n.d(t,"b",(function(){return v})),n.d(t,"e",(function(){return b})),n.d(t,"d",(function(){return S})),n.d(t,"a",(function(){return E})),n.d(t,"f",(function(){return _}));var r=n(10),o=n.n(r),i=(n(13),n(4)),a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function c(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){t({width:r.naturalWidth,height:r.naturalHeight})},r.src=e}))}function u(e,t){return 1===t?Promise.resolve(e):new Promise((function(t,n){var r=new Image;r.onload=function(){t(r)},r.src=e})).then((function(n){var r=p(n.naturalWidth,n.naturalHeight,t);return w({canvas:r,dataURI:e,x:0,y:0,width:n.naturalWidth*t,height:n.naturalHeight*t}).then((function(){return r.toDataURL()}))}))}function l(e,t){var n="function"==typeof t,r=t&&!n,i=o.a.tabs.captureVisibleTab(null,{format:"png"}),a=r?Promise.resolve(t):i.then((function(t){return function(e,t,n){return Promise.all([c(e),o.a.tabs.get(t)]).then((function(e){var t=s(e,2),r=t[0];return t[1].width*n/r.width}))}(t,e,window.devicePixelRatio)}));return Promise.all([i,a]).then((function(e){var o=s(e,2),i=o[0],a=o[1];return!r&&n&&t(a),1===a?i:u(i,a)}))}function d(){var e=void 0;return function(t){return l(t,e||function(t){e=t})}}function h(e,t,n){return function(e){return l(e).then(i.dataURItoBlob)}(t).then((function(t){return e.overwrite(n,t).then((function(e){return{url:e,fileName:n}}))}))}function f(e){return e.reduce((function(e,t){return e.then(t)}),Promise.resolve())}function g(e){for(var t=e.pageWidth,n=e.pageHeight,r=e.windowWidth,o=e.windowHeight,i=e.topPadding,a=void 0===i?150:i,s=r,c=o-(o>a?a:0),u=[],l=n-o;l>-1*c;l-=c)for(var d=0;d<t;d+=s)u.push({x:d,y:l});return u}function m(e,t){for(var n=e.x,r=e.y,o=e.width,i=e.height,a=(t.pageWidth,t.pageHeight,t.windowWidth),s=t.windowHeight,c=(t.originalX,t.originalY,t.topPadding),u=void 0===c?150:c,l=a,d=s-(s>u?u:0),h=[],f=r+i-s;f>r-d;f-=d)for(var g=n;g<n+o;g+=l)h.push({x:g,y:f});return 0===h.length&&h.push({x:n,y:r+i-s}),h}function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=document.createElement("canvas");return r.width=e*n,r.height=t*n,r}function w(e){var t=e.canvas,n=e.dataURI,r=e.x,o=e.y,i=e.width,a=e.height;return new Promise((function(e,s){var c=new Image;c.onload=function(){t.getContext("2d").drawImage(c,0,0,c.width,c.height,r,o,i||c.width,a||c.height),e({x:r,y:o,width:i,height:a})},c.src=n}))}function y(e,t,n){return e().then((function(e){return delete e.sender,n(e).then((function(n){return t(e),n}))}))}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E,n=t.startCapture,r=t.scrollPage,o=t.endCapture,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=a({blob:!1},s);return y(n,o,(function(t){var n=t.devicePixelRatio,o=Math.floor(32767/n);t.pageWidth=Math.min(o,t.pageWidth),t.pageHeight=Math.min(o,t.pageHeight);var a=d(),s=p(t.pageWidth,t.pageHeight,n),u=g(t),l=u.map((function(o,i){return function(){return r(o,{index:i,total:u.length}).then((function(r){return a(e).then((function(e){return w({canvas:s,dataURI:e,x:r.x*n,y:r.y*n,width:t.windowWidth*n,height:t.windowHeight*n})}))}))}})),h=c.blob?i.dataURItoBlob:function(e){return e};return f(l).then((function(){return h(s.toDataURL())}))}))}function b(e,t){var n=t.rect,r=t.devicePixelRatio,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=a({blob:!1},o),c=s.blob?i.dataURItoBlob:function(e){return e},u=r,d=p(n.width,n.height,u);return l(e).then((function(e){return w({canvas:d,dataURI:e,x:-1*n.x*r,y:-1*n.y*r})})).then((function(){return c(d.toDataURL())}))}function S(e,t,n){var r=t.rect,o=t.devicePixelRatio,s=n.startCapture,c=n.scrollPage,u=n.endCapture,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},h=a({blob:!1},l),g=h.blob?i.dataURItoBlob:function(e){return e},v=o;return y(s,u,(function(t){var n=Math.floor(32767/v);t.pageWidth=Math.min(n,t.pageWidth),t.pageHeight=Math.min(n,t.pageHeight);var i=d(),a=p(r.width,r.height,v),s=m(r,t);return f(s.map((function(n,u){return function(){return c(n,{index:u,total:s.length}).then((function(n){return i(e).then((function(e){return w({canvas:a,dataURI:e,x:(n.x-r.x)*o,y:(n.y-r.y)*o,width:t.windowWidth*o,height:t.windowHeight*o})}))}))}}))).then((function(){return g(a.toDataURL())}))}))}var E={getPageInfo:function(){var e=document.body,t=[document.documentElement.clientWidth,document.documentElement.scrollWidth,document.documentElement.offsetWidth,e?e.scrollWidth:0,e?e.offsetWidth:0],n=[document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight,e?e.scrollHeight:0,e?e.offsetHeight:0];return{pageWidth:Math.max.apply(Math,t),pageHeight:Math.max.apply(Math,n),windowWidth:window.innerWidth,windowHeight:window.innerHeight,hasBody:!!e,originalX:window.scrollX,originalY:window.scrollY,originalOverflowStyle:document.documentElement.style.overflow,originalBodyOverflowYStyle:e&&e.style.overflowY,devicePixelRatio:window.devicePixelRatio}},startCapture:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.hideScrollbar,n=void 0===t||t,r=document.body,o=E.getPageInfo();return r&&(r.style.overflowY="visible"),n&&(document.documentElement.style.overflow="hidden"),Promise.resolve(o)},scrollPage:function(e){var t=e.x,n=e.y;return window.scrollTo(t,n),Object(i.delay)((function(){return{x:window.scrollX,y:window.scrollY}}),100)},endCapture:function(e){var t=e.originalX,n=e.originalY,r=e.hasBody,o=e.originalOverflowStyle,i=e.originalBodyOverflowYStyle;return r&&(document.body.style.overflowY=i),document.documentElement.style.overflow=o,window.scrollTo(t,n),Promise.resolve(!0)}};function _(e,t,n,r){return v(t,r,{blob:!0}).then((function(t){return e.overwrite(n,t).then((function(e){return{url:e,fileName:n}}))}))}},97:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t,n,r){this.requestObject={id:e,method:t,params:n},this.callback=r}get request(){return this.requestObject}}t.NativeMessagingHost=class{constructor(e){this.internalHostName=e,this.nextInvocationId=1,this.queue=new Array,this.handleMessage=this.handleMessage.bind(this),this.handleDisconnect=this.handleDisconnect.bind(this)}processResponse(e,t,n){let r=void 0;for(let t=0;t<this.queue.length;++t){const n=this.queue[t];if(n.request.id===e){r=n.callback,this.queue.splice(t,1);break}}r&&r(t,n)}handleMessage(e){const t=e;"number"==typeof t.id&&this.processResponse(t.id,t.result,t.error)}handleDisconnect(){this.disconnect()}get hostName(){return this.internalHostName}connectAsync(){return this.port||(this.port=chrome.runtime.connectNative(this.hostName),this.port.onMessage.addListener(this.handleMessage),this.port.onDisconnect.addListener(this.handleDisconnect)),this.invokeAsync("get_version",void 0)}disconnect(){const e=chrome.runtime.lastError&&chrome.runtime.lastError.message||"Disconnected";this.port&&(this.port.disconnect(),this.port=void 0);const t=this.queue.map(e=>e.request.id);for(const n of t)this.processResponse(n,void 0,{message:e});this.queue=new Array}invoke(e,t,n){if(!this.port)return void n(void 0,{message:"Disconnected"});const o=this.nextInvocationId++,i=new r(o,e,t,n);this.queue.push(i),this.port.postMessage(i.request)}invokeAsync(e,t){return new Promise((n,r)=>{this.invoke(e,t,(e,t)=>{chrome.runtime.lastError&&(t=new Error(chrome.runtime.lastError.message)),t?r(t):n(e)})})}}}});